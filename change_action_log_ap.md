# AP Boost Change Action Log

> **Instructions for Claude:** Log every apBoost code change to this file. Add a new row for each modification with the date, file path, and a brief description of what changed.

| Date | File | Change |
|------|------|--------|
| 2026-01-14 | src/apBoost/hooks/useOfflineQueue.js | Fixed FRQ sub-answer data loss: ANSWER_CHANGE now uses nested Firestore paths (`answers.${questionId}.${subQuestionLabel}`) when subQuestionLabel exists, added deduplication by (questionId, subQuestionLabel) for last-write-wins safety |
| 2026-01-14 | src/apBoost/components/FRQTextInput.jsx | Added onBlur handler with dedupe guard: new `onBlur` prop, `lastBlurValueRef` to avoid duplicate saves, `handleBlur` triggers save only when value changed |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Wired FRQTextInput onBlur prop to setAnswer for blur-save safety net |
| 2026-01-14 | src/apBoost/components/FRQQuestionDisplay.jsx | Added multi-stimulus DBQ support: DocumentSelector component with scrollable tabs, array stimuli detection, activeDocIndex state, supports question.stimuli (plural) field, backward compatible |
| 2026-01-14 | src/apBoost/components/AnswerInput.jsx | Implemented MCQ_MULTI multi-select: added QUESTION_TYPE import, handleSelect for toggle logic (array storage), checkbox UI with square checkmark for MCQ_MULTI while keeping circular badge for MCQ |
| 2026-01-14 | src/apBoost/services/apScoringService.js | Fixed MCQ_MULTI scoring: added calculateMCQMultiScore helper (partial credit + all-or-nothing), updated calculateMCQScore to branch on questionType, updated mcqResults building to include score/questionType fields |
| 2026-01-14 | src/apBoost/pages/APReportCard.jsx | Format array answers: studentAnswer displayed as sorted comma-separated string for MCQ_MULTI |
| 2026-01-14 | src/apBoost/utils/generateReportPdf.js | Format array answers: studentAnswer formatted before doc.text() for MCQ_MULTI |
| 2026-01-14 | src/apBoost/services/apAnalyticsService.js | Canonicalize array keys: MCQ_MULTI answers joined without separator for stable distribution bucketing |
| 2026-01-14 | src/apBoost/components/QuestionDisplay.jsx | Added "Select all that apply" hint for MCQ_MULTI in both HORIZONTAL and VERTICAL layouts |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__20__20.4_to_20.7.md | Created codebase facts report for sections 20.4-20.7: documented AP question creation (APQuestionEditor handleSave payload for MCQ/MCQ_MULTI/FRQ/SAQ/DBQ), test editor question reordering (reorderSectionQuestions imported but NEVER called in APTestEditor, no transaction/concurrency protection), annotated PDF display (annotatedPdfUrl consistently named, gated by isGradingComplete && annotatedPdfUrl), design tokens (QuestionDetailModal uses raw bg-green-50/bg-red-50/text-green-700/text-red-700 instead of bg-success/bg-error/text-success-text-strong/text-error-text-strong tokens defined in index.css), logError signature (functionName, context, error) |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__14__14.1_to_14.4.md | Created codebase facts report for sections 14.1-14.4: documented UI component exports (Button variants/sizes, Modal API), all 8 apBoost services import db from ../../firebase (not ../../services/db.js), withRetry/logSystemEvent exist but NOT used in apBoost, apStorageService uses storage only, 3 modals + QuestionNavigator use custom backdrop patterns, performanceColors uses raw Tailwind in 5 files, ThemeContext wraps app but apBoost doesn't call useTheme(), design tokens in :root + @theme blocks |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/CODEBASE_FACTS__20__20.1_to_20.3.md | Created codebase facts report for Seed Data & Phase Verification (sections 20.1-20.3): documented all schema source-of-truth locations (ap_tests, ap_questions with subQuestions, ap_classes, ap_assignments, ap_test_results), write paths (seed, offline queue, submit, grading), offline/resilience mechanics (IndexedDB, 15s heartbeat, MAX_FAILURES=3, BroadcastChannel+sessionToken takeover), UI flow entry points, answered 12 must-answer questions including: seedAPTestData only MCQ, no FRQ seed data, separate sections for mixed tests, flushQueue guaranteed before submit, no isSyncing/queueLength in ReviewScreen, APReportCard uses getDoc not onSnapshot, no annotation props in ReviewScreen |
| 2026-01-14 | CODEBASE_FACTS__UNK__19.1_to_19.10.md | Created codebase facts report for Utilities Detailed (sections 19.1-19.10): AP_SUBJECTS in apTestConfig.js (no ID constants in apTypes), no default time limits, DEFAULT_SCORE_RANGES in wrong file (apTypes vs apTestConfig), logError stores raw context (no field extraction), no logo in answer sheet PDF, PDF return type inconsistency (Blob vs jsPDF), no SECTION_TYPE_CONFIG, no validateSession utility, no HEIC conversion, no image compression |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__09__9.1_to_9.4.md | Created codebase facts report for Report Card/Gradebook (sections 9.1-9.4): documented ap_test_results schema (mcqResults lacks domain/topic), annotatedPdfUrl field consistency confirmed, downloadReportPdf NOT imported anywhere, APReportCard uses auth user not result.userId for student name, no getClassById function exists, mcqMultiplier only (no frqMultiplier), View action opens GradingPanel (no navigation), missing Firestore rules for ap_* collections |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__17.1_to_17.6.md | Created codebase facts report for Hooks Detailed (sections 17.1-17.6): documented session state schema (annotations/strikethroughs/flaggedQuestions shapes), ANNOTATION_UPDATE not handled in flushQueue (falls to default), FLAG_TOGGLE placeholder only, no visibilitychange flush trigger, no opportunistic mode after 5 retries, IndexedDB ap_boost_queue schema with PENDING→deleted (no CONFIRMED), heartbeat sessionToken check, combined isSessionInvalidated in useTestSession |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__11__11.1_to_11.5.md | Created codebase facts report for Teacher Flow Pages (sections 11.1-11.5): documented test sections schema (sections[].questionIds), reorderSectionQuestions imported but unused, question row UI has no move buttons, section reorder via local state only, sessionStorage picker-mode with testEditor_state key, no TestSectionSelector component, students selected by class only (no search), maxAttempts defaults to 1, APGradebook uses getDocs (no onSnapshot), no DnD library installed |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__05__5.1_to_5.5.md | Created codebase facts report for offline queue/resilience: IndexedDB schema (ap_boost_queue, actions store), 1s debounce hardcoded, FLAG_TOGGLE empty case, ANNOTATION_UPDATE not handled, no CONFIRMED status, exponential backoff (2-16s), beforeunload warning-only, no visibilitychange flush, heartbeat no recovery callback, getActiveSession only queries IN_PROGRESS not PAUSED, no backend pause endpoint |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__4.1_to_4.5.md | Created codebase facts report for scoring pipeline: MCQ_MULTI not implemented (single-select only), partialCredit field unused, frqMultiplier not found, multiplier vs mcqMultiplier field mismatch, frqMaxPoints hardcoded to 0, duplicate calculateAPScore (grading ignores scoreRanges), mcqScore/mcqMaxPoints field mismatch between create and grading |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/CODEBASE_FACTS__UNK__2.3.1_to_2.5.md | Created codebase facts report for FRQ textarea persistence, offline queue, DBQ stimuli, manual grading: documented FRQTextInput (controlled, no onBlur), ANSWER_CHANGE subQuestionLabel bug (overwrites), 1s debounce, beforeunload warning-only, no visibilitychange flush, no question.stimuli array, grading write flow via APGradebook→GradingPanel→saveGrade |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__2.1_to_2.3.md | Created comprehensive codebase facts report for MCQ_MULTI runtime UI + scoring: documented QUESTION_TYPE schema, answer storage paths (useTestSession→useOfflineQueue→Firestore), AnswerInput single-select limitation, missing QuestionDisplay hints, apScoringService includes() logic gap, downstream consumers assuming string studentAnswer |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__1.5_to_1.9.md | Created comprehensive codebase facts report for sections 1.5-1.9 (LineReader, section locking, session PAUSED status, annotation restore, dashboard maxAttempts, offline queue action types) |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_11.1_to_11.5_fix_plan.md | Created fix plan for Teacher Flow Pages (6 issues: question reorder, section drag-and-drop, Add-to-Test dropdown, individual student search, maxAttempts default, real-time gradebook updates) |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_6.1_to_6.7_fix_plan.md | Created fix plan for Error Handling (7 issues: replace console.error with logError, fix silent catch blocks, create validateSessionData utility, add error type constants/detection, add user-facing error messages, add guard clauses to services, enhance logError with automatic context) |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_12.1_to_13.2_fix_plan.md | Created fix plan for User Roles & Routes (14 issues: Download PDF button, RoleProtectedRoute, class management page, isPublic toggle, missing routes for /test/new, /gradebook/:resultId, /student/:userId, /class/:classId, gradebook path rename) |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_9.1_to_9.4_fix_plan.md | Created fix plan for Report Card (11 issues: Download PDF button, class name display, MCQ/FRQ domain+topic columns, weighted FRQ display, teacher view navigation, student name fetching, button labels, PDF class name) |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_10.1_to_10.9_fix_plan.md | Created fix plan for Exam Analytics Dashboard (6 issues: MCQ/FRQ PDF buttons, FRQ rubric modal, Report Card icon, Student Profile route and stub page) |
| 2026-01-12 | ap_boost_spec_plan.md | Added Section 3.4: FRQ Submission & Grading Flow (typed vs handwritten modes, answer sheet PDF generation, upload flow, teacher grading interface, grading states) |
| 2026-01-12 | ap_boost_spec_plan.md | Added Section 3.5: Report Card (Results View) - layout wireframe, data sources, PDF export spec |
| 2026-01-12 | ap_boost_spec_plan.md | Updated ap_test_results collection: added frqSubmissionType, frqUploadUrl, frqGradedPdfUrl, frqGrades, gradingStatus fields |
| 2026-01-12 | ap_boost_spec_plan.md | Updated folder structure: added APReportCard.jsx, APGradebook.jsx pages; grading/ and report/ component folders; apGradingService.js, apStorageService.js services; generateAnswerSheetPdf.js, generateReportPdf.js, fileUpload.js utils |
| 2026-01-12 | ap_boost_spec_plan.md | Updated Appendix B Routes: added /ap/results/:resultId, /ap/teacher/gradebook routes |
| 2026-01-12 | ap_boost_spec_plan.md | Added testType (EXAM/MODULE) to ap_tests, ap_assignments collection (junction table), attempt tracking fields to ap_test_results |
| 2026-01-12 | ap_boost_spec_plan.md | Added Section 4.15: Error Handling Conventions (error boundary, async patterns, null handling, timeouts, user messages) |
| 2026-01-12 | ap_boost_spec_plan.md | Updated Section 4.7: Timer Behavior - clarified mobile backgrounding (pause after 30s hidden) |
| 2026-01-12 | ap_boost_spec_plan.md | Updated folder structure - added APErrorBoundary.jsx, ErrorFallback.jsx, SessionSkeleton.jsx, logError.js, withTimeout.js, validateSession.js |
| 2026-01-12 | ap_boost_spec_plan.md | Major update to Section 3.1 (ap_tests): Added questionOrder, scoreRanges (customizable AP 1-5), removed totalTime (now calculated), added section fields (sectionType, calculatorEnabled, mcqMultiplier, frqMultipliers) |
| 2026-01-12 | ap_boost_spec_plan.md | Added Section 3.1 (ap_stimuli): New collection for shared stimuli with type, content, source, imageAlt fields |
| 2026-01-12 | ap_boost_spec_plan.md | Major update to Section 3.1 (ap_questions): Renamed prompt→questionText, added questionType (MCQ_MULTI), individual choice fields (choiceA-J with imageUrl/imageAlt), choiceCount, format (VERTICAL/HORIZONTAL), questionDomain, questionTopic, difficulty, correctAnswers array, partialCredit, explanation, subQuestions for FRQ |
| 2026-01-12 | ap_boost_spec_plan.md | Added Section 3.3: Scoring Flow - calculation process, example with multipliers, partial credit for MCQ_MULTI, FRQ sub-question scoring |
| 2026-01-12 | ap_boost_spec_plan.md | Updated Section 3.2 Indexes: Added ap_stimuli indexes, questionDomain and difficulty filters |
| 2026-01-12 | ap_boost_spec_plan.md | Added Section 3.6: Exam Analytics Dashboard - filters (multi-select class/student), color scale table, MCQ grid wireframe, MCQ detail modal, MCQ detailed view, FRQ grid wireframe, student list with columns |
| 2026-01-12 | ap_boost_spec_plan.md | Added APStudentProfile stub page at /ap/teacher/student/:userId |
| 2026-01-12 | ap_boost_spec_plan.md | Updated folder structure: added APExamAnalytics.jsx, APStudentProfile.jsx pages; analytics/ component folder (PerformanceGrid, MCQSquare, FRQCard, QuestionDetailModal, MCQDetailedView, StudentResultsTable, FilterBar); apAnalyticsService.js; performanceColors.js, generateQuestionsPdf.js utils |
| 2026-01-12 | ap_boost_spec_plan.md | Updated Appendix B Routes: added /ap/teacher/analytics/:testId, /ap/teacher/student/:userId |
| 2026-01-12 | ap_boost_spec_plan.md | Major update to Section 5.1: Added question display format clarification (VERTICAL=1 column no stimulus, HORIZONTAL=2 columns with stimulus) |
| 2026-01-12 | ap_boost_spec_plan.md | Major update to Section 5.2: Replaced navigation dots with bottom bar + slide-up modal navigation system |
| 2026-01-12 | ap_boost_spec_plan.md | Updated Section 5.4: Redesigned Review Screen as full page with question grid boxes |
| 2026-01-12 | ap_boost_spec_plan.md | Renumbered Section 5.5 (Connection Status Banner) and 5.6 (Duplicate Tab Modal) |
| 2026-01-12 | ap_boost_spec_plan.md | Added TODO note to Section 3.3.3 (Partial Credit) for formula to be revisited later |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Removed timer warning thresholds from Section 1.5 (Time Expiry Behavior) |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Updated Timer Architecture - removed onWarning and warningThresholds |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Updated QuestionNavigator references from "dot navigation" to "slide-up modal navigation" |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Updated useTimer hook spec - removed warning-related props |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Updated QuestionNavigatorProps interface for modal-based navigation |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Updated component style patterns - replaced dot styles with box styles |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Updated verification checklist for new navigation UI |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Expanded Phase 1 with detailed service function signatures (apTestService, apSessionService, apScoringService) |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added hook specifications (useTestSession, useTimer) with full return type documentation |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added component props interfaces (TestCard, InstructionScreen, QuestionDisplay, AnswerInput, TestTimer, QuestionNavigator, ReviewScreen, APReportCard) |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added data flow diagram showing Firestore ↔ Session Service ↔ Local State architecture |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added styling approach: Tailwind CSS with apBoost theme colors and component style patterns |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added complete route definitions for student and teacher routes |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added Part 7: State Shapes (Session, TestResult, UIState TypeScript interfaces) |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added Part 8: Error Handling Strategy (APError class, ErrorCodes, recovery flows) |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added Part 9: Testing Strategy (unit tests for services/hooks, integration tests) |
| 2026-01-12 | squishy-giggling-pearl.md (plan) | Added Part 11: Implementation Order (Phase 1 Day-by-Day breakdown, 10 days) |
| 2026-01-12 | src/apBoost/implementation/ | Created implementation folder with phase-specific markdown plans |
| 2026-01-12 | src/apBoost/implementation/phase1-foundation.md | Phase 1 plan: folder structure, routes, services, hooks, components for MCQ test-taking |
| 2026-01-12 | src/apBoost/implementation/phase2-session-resilience.md | Phase 2 plan: offline queue, heartbeat, duplicate tab detection, error boundary |
| 2026-01-12 | src/apBoost/implementation/phase3-frq-support.md | Phase 3 plan: FRQ sub-question navigation, typed input, grading panel |
| 2026-01-14 | docs/ap_boost_acceptance_criteria.md | Created exhaustive acceptance criteria document (400+ items) covering all 17 aspects: core features, question types, data model, scoring, session state, error handling, UI/UX, FRQ grading, report card, analytics, user roles, routes, architecture, hooks, services, components, utilities |
| 2026-01-12 | src/apBoost/implementation/phase4-tools.md | Phase 4 plan: highlighter, strikethrough, line reader annotation tools |
| 2026-01-12 | src/apBoost/implementation/phase5-teacher-flow.md | Phase 5 plan: teacher dashboard, test editor, question bank, class assignment |
| 2026-01-12 | src/apBoost/implementation/phase6-frq-handwritten.md | Phase 6 plan: PDF answer sheet generation, file upload, grading panel updates |
| 2026-01-12 | src/apBoost/implementation/phase7-analytics.md | Phase 7 plan: performance grids, question detail modal, student table, PDF exports |
| 2026-01-12 | src/apBoost/implementation/README.md | Implementation folder README with workflow and phase overview |
| 2026-01-12 | src/apBoost/utils/apTypes.js | Created: Constants for question types, session status, collections, etc. |
| 2026-01-12 | src/apBoost/utils/apTestConfig.js | Created: AP subject configs, time formatting utilities |
| 2026-01-12 | src/apBoost/routes.jsx | Created: Route definitions for /ap, /ap/test/:testId, /ap/results/:resultId |
| 2026-01-12 | src/apBoost/index.js | Created: Export barrel file for apBoost module |
| 2026-01-12 | src/App.jsx | Added: apBoost routes import and integration |
| 2026-01-12 | src/apBoost/pages/APDashboard.jsx | Created: Test list page with TestCard component, loading states |
| 2026-01-12 | src/apBoost/pages/APTestSession.jsx | Created: Main test interface with instruction/testing/review views |
| 2026-01-12 | src/apBoost/pages/APReportCard.jsx | Created: Results display with AP score, section scores, MCQ table |
| 2026-01-12 | src/apBoost/components/APHeader.jsx | Created: Header with AP branding and user info |
| 2026-01-12 | src/apBoost/components/InstructionScreen.jsx | Created: Pre-test instruction display with section breakdown |
| 2026-01-12 | src/apBoost/components/QuestionDisplay.jsx | Created: Question renderer supporting VERTICAL and HORIZONTAL formats |
| 2026-01-12 | src/apBoost/components/AnswerInput.jsx | Created: MCQ radio button group with strikethrough support |
| 2026-01-12 | src/apBoost/components/QuestionNavigator.jsx | Created: Bottom bar + slide-up modal navigation |
| 2026-01-12 | src/apBoost/components/ReviewScreen.jsx | Created: Full-page review with question grid and summary |
| 2026-01-12 | src/apBoost/components/TestTimer.jsx | Created: Countdown timer display in MM:SS format |
| 2026-01-12 | src/apBoost/services/apTestService.js | Created: Functions for fetching tests, questions, assignments |
| 2026-01-12 | src/apBoost/services/apSessionService.js | Created: Session CRUD, answer saving, flag toggling, timer sync |
| 2026-01-12 | src/apBoost/services/apScoringService.js | Created: MCQ scoring, AP score calculation, result creation |
| 2026-01-12 | src/apBoost/hooks/useTimer.js | Created: Timer hook with start/pause/resume/reset controls |
| 2026-01-12 | src/apBoost/hooks/useTestSession.js | Created: Core session management hook combining all state |
| 2026-01-12 | src/apBoost/utils/seedTestData.js | Created: Seed data script for development testing |
| 2026-01-12 | src/apBoost/utils/logError.js | Created: Centralized error logging utility with context support |
| 2026-01-12 | src/apBoost/utils/withTimeout.js | Created: Promise timeout wrapper for network operations |
| 2026-01-12 | src/apBoost/hooks/useOfflineQueue.js | Created: IndexedDB-backed offline queue with retry logic |
| 2026-01-12 | src/apBoost/hooks/useHeartbeat.js | Created: 15-second server ping, session takeover detection |
| 2026-01-12 | src/apBoost/hooks/useDuplicateTabGuard.js | Created: BroadcastChannel + Firestore duplicate tab detection |
| 2026-01-12 | src/apBoost/components/ConnectionStatus.jsx | Created: Banner for disconnected/syncing states |
| 2026-01-12 | src/apBoost/components/DuplicateTabModal.jsx | Created: Modal for session active elsewhere |
| 2026-01-12 | src/apBoost/components/APErrorBoundary.jsx | Created: React error boundary for crash recovery |
| 2026-01-12 | src/apBoost/components/ErrorFallback.jsx | Created: Fallback UI with retry and dashboard links |
| 2026-01-12 | src/apBoost/hooks/useTestSession.js | Updated: Integrated useOfflineQueue, useHeartbeat, useDuplicateTabGuard; added beforeunload handler |
| 2026-01-12 | src/apBoost/pages/APTestSession.jsx | Updated: Added ConnectionStatus, DuplicateTabModal, APErrorBoundary wrapper |
| 2026-01-12 | src/apBoost/components/FRQTextInput.jsx | Created: Auto-resizing textarea for FRQ answers with character count |
| 2026-01-12 | src/apBoost/components/FRQQuestionDisplay.jsx | Created: FRQ question renderer with sub-question highlighting, stimulus support |
| 2026-01-12 | src/apBoost/components/QuestionDisplay.jsx | Updated: Added FRQ delegation to FRQQuestionDisplay, subQuestionLabel prop |
| 2026-01-12 | src/apBoost/hooks/useTestSession.js | Updated: Added FRQ sub-question navigation (flatNavigationItems, goToFlatIndex), FRQ answer format |
| 2026-01-12 | src/apBoost/components/QuestionNavigator.jsx | Updated: Support flat navigation items for FRQ sub-questions (1a, 1b, 1c, etc.) |
| 2026-01-12 | src/apBoost/pages/APTestSession.jsx | Updated: Added FRQ support with FRQTextInput, subQuestionLabel, flat navigation |
| 2026-01-12 | src/apBoost/pages/APReportCard.jsx | Updated: Added partial results support (awaiting grade), FRQ submitted answers display, FRQ graded results |
| 2026-01-12 | src/apBoost/services/apGradingService.js | Created: getPendingGrades, getResultForGrading, saveGrade, calculateFRQScore functions |
| 2026-01-12 | src/apBoost/components/grading/GradingPanel.jsx | Created: Side panel for FRQ grading with score inputs and comments |
| 2026-01-12 | src/apBoost/pages/APGradebook.jsx | Created: Teacher grading list page with filters and grading panel |
| 2026-01-12 | src/apBoost/routes.jsx | Updated: Added /ap/gradebook route for teacher grading |
| 2026-01-12 | src/apBoost/hooks/useAnnotations.js | Created: Annotation hook managing highlights, strikethroughs, line reader state with persistence support |
| 2026-01-12 | src/apBoost/components/tools/Highlighter.jsx | Created: Text highlighting component with color picker popup, selection handling |
| 2026-01-12 | src/apBoost/components/tools/LineReader.jsx | Created: Focus line reader overlay with keyboard navigation (arrow keys) |
| 2026-01-12 | src/apBoost/components/tools/ToolsToolbar.jsx | Created: Toolbar for highlight color, line reader toggle, visible lines, clear all |
| 2026-01-12 | src/apBoost/components/tools/PassageDisplay.jsx | Created: Stimulus display integrating Highlighter, LineReader, ToolsToolbar components |
| 2026-01-12 | src/apBoost/components/QuestionDisplay.jsx | Updated: Added annotation props, integrated PassageDisplay for HORIZONTAL layout with text stimulus |
| 2026-01-12 | src/apBoost/components/AnswerInput.jsx | Updated: Added strikethroughs Set and onStrikethrough callback props for answer elimination |
| 2026-01-12 | src/apBoost/hooks/useTestSession.js | Updated: Exported addToQueue for annotation persistence |
| 2026-01-12 | src/apBoost/pages/APTestSession.jsx | Updated: Integrated useAnnotations hook, connected highlight/strikethrough/line reader to QuestionDisplay and AnswerInput |
| 2026-01-12 | src/apBoost/services/apTeacherService.js | Created: Teacher service with getTeacherTests, createTest, updateTest, deleteTest, getTeacherClasses, createAssignment, getPendingGradingCount, publishTest |
| 2026-01-12 | src/apBoost/services/apQuestionService.js | Created: Question service with searchQuestions, createQuestion, updateQuestion, deleteQuestion, addQuestionsToSection, removeQuestionFromSection, reorderSectionQuestions |
| 2026-01-12 | src/apBoost/pages/APTeacherDashboard.jsx | Created: Teacher home page with quick actions, tests list, pending grading count, classes list |
| 2026-01-12 | src/apBoost/pages/APTestEditor.jsx | Created: Test editor page with section management, question assignment, score ranges configuration |
| 2026-01-12 | src/apBoost/pages/APQuestionBank.jsx | Created: Question bank with filters (subject, type, difficulty, domain), search, preview modal, picker mode for test editor |
| 2026-01-12 | src/apBoost/pages/APQuestionEditor.jsx | Created: Question editor for MCQ/FRQ with choice editor, sub-question editor, metadata |
| 2026-01-12 | src/apBoost/pages/APAssignTest.jsx | Created: Test assignment page wrapper for AssignTestModal |
| 2026-01-12 | src/apBoost/components/teacher/AssignTestModal.jsx | Created: Modal for assigning tests to classes with due date, max attempts, FRQ mode settings |
| 2026-01-12 | src/apBoost/routes.jsx | Updated: Added teacher routes (/ap/teacher, /ap/teacher/test/:testId/edit, /ap/teacher/test/:testId/assign, /ap/teacher/questions, /ap/teacher/question/:questionId/edit) |
| 2026-01-12 | src/apBoost/utils/generateAnswerSheetPdf.js | Created: PDF answer sheet generation using jsPDF with question prompts and writing spaces |
| 2026-01-12 | src/firebase.js | Updated: Added Firebase Storage import and export, storage emulator connection |
| 2026-01-12 | src/apBoost/services/apStorageService.js | Created: Storage service with validateFile, uploadFRQAnswerSheet, uploadGradedPdf, getFileDownloadUrl, deleteUpload, formatFileSize |
| 2026-01-12 | src/apBoost/components/FileUpload.jsx | Created: Drag-and-drop file upload component with preview, progress, validation |
| 2026-01-12 | src/apBoost/components/FRQHandwrittenMode.jsx | Created: Handwritten submission flow with 4 steps (download PDF, write, scan, upload) |
| 2026-01-12 | src/apBoost/components/grading/GradingPanel.jsx | Updated: Added HandwrittenViewer component for uploaded images/PDFs with zoom, rotate, navigation; annotated PDF upload section |
| 2026-01-12 | src/apBoost/services/apGradingService.js | Updated: saveGrade now accepts annotatedPdfUrl parameter for handwritten feedback |
| 2026-01-12 | src/apBoost/pages/APReportCard.jsx | Updated: Added HandwrittenFilesSection for viewing uploaded files and teacher's annotated PDF download |
| 2026-01-12 | src/apBoost/pages/APTestSession.jsx | Updated: Added FRQ submission type choice screen, handwritten mode view with FRQHandwrittenMode, frqSubmissionType and uploadedFiles state |
| 2026-01-12 | src/apBoost/hooks/useTestSession.js | Updated: submitTest now accepts frqData parameter for handwritten submission info |
| 2026-01-12 | src/apBoost/services/apScoringService.js | Updated: createTestResult now accepts frqData and stores frqSubmissionType, frqUploadedFiles, annotatedPdfUrl fields |
| 2026-01-13 | src/apBoost/utils/performanceColors.js | Created: Performance color thresholds (>85% green, 70-85% lime, 60-70% yellow, 50-60% orange, <50% red) with getPerformanceColor, getPerformanceInfo, getAPScoreColor utilities |
| 2026-01-13 | src/apBoost/services/apAnalyticsService.js | Created: Analytics aggregation service with getTestAnalytics, calculateQuestionPerformance, calculateResponseDistribution, calculateFRQPerformance, calculateSummaryStats, getStudentResults, getClassesForFilter, getStudentsForFilter |
| 2026-01-13 | src/apBoost/components/analytics/FilterBar.jsx | Created: Multi-select dropdown filters for classes and students with apply button |
| 2026-01-13 | src/apBoost/components/analytics/MCQSquare.jsx | Created: Single question performance square with color coding based on percentage |
| 2026-01-13 | src/apBoost/components/analytics/PerformanceGrid.jsx | Created: Grid of MCQSquare components with color legend and summary stats |
| 2026-01-13 | src/apBoost/components/analytics/QuestionDetailModal.jsx | Created: Modal showing question text, stimulus, and response distribution bars (green/red for correct/incorrect) |
| 2026-01-13 | src/apBoost/components/analytics/FRQCard.jsx | Created: FRQ performance card with nested SubQuestionSquare components showing sub-question performance |
| 2026-01-13 | src/apBoost/components/analytics/MCQDetailedView.jsx | Created: Expanded list view showing all questions with inline response distributions |
| 2026-01-13 | src/apBoost/components/analytics/StudentResultsTable.jsx | Created: Sortable student results table with Name, Email, MCQ, FRQ, Total, AP Score columns and report links |
| 2026-01-13 | src/apBoost/pages/APExamAnalytics.jsx | Created: Main analytics dashboard with summary cards, AP score distribution, MCQ grid/detailed toggle, FRQ cards, student results table |
| 2026-01-13 | src/apBoost/utils/generateReportPdf.js | Created: PDF report card generation using jsPDF with student info, AP score, section breakdown, MCQ results table, FRQ grades |
| 2026-01-13 | src/apBoost/utils/generateQuestionsPdf.js | Created: PDF questions export for teachers with includeAnswers and includeStimuli options |
| 2026-01-13 | src/apBoost/routes.jsx | Updated: Added APExamAnalytics import and /ap/teacher/analytics/:testId route |
| 2026-01-14 | docs/ap_boost_acceptance_criteria.md | Updated: Expanded from 400+ to 500+ acceptance criteria based on implementation docs review. Added sections: 1.8-1.12 (InstructionScreen, APDashboard, APTestSession states, PassageDisplay, ToolsToolbar), 2.3.1-2.3.2 (FRQ sub-question navigation, FRQTextInput), 5.2.1 (useOfflineQueue hook), 5.5.1 (useHeartbeat hook), 5.6.4 (useDuplicateTabGuard hook), 6.2.1 (APErrorBoundary implementation), detailed highlighter/strikethrough/line reader criteria, 8.3.1-8.4.2 (FRQHandwrittenMode, FileUpload, GradingPanel, PDF Viewer), 11 (Teacher Flow Pages), 16-18 (detailed hooks, services, utilities), 19 (seed data), 20 (phase verification checklists) |
| 2026-01-14 | src/apBoost/criteria_audit/section_1.1_to_1.4_criteria_audit.md | Created: Audit report for Sections 1.1-1.4 (Timed Sections, Question Flagging, Highlighter Tool, Strikethrough Tool). Results: 30 ✅ Implemented, 8 ⚠️ Partial, 3 ❌ Missing. Key gaps: timer auto-submit only logs (not implemented), mobile background pause missing, offline queue doesn't persist FLAG_TOGGLE or ANNOTATION_UPDATE, flagged questions not listed in review summary |
| 2026-01-14 | src/apBoost/criteria_audit/section_1.10_to_1.12_criteria_audit.md | Created: Audit report for Sections 1.10-1.12 (APTestSession Page States, PassageDisplay, ToolsToolbar). Results: 15 ✅ Implemented, 3 ⚠️ Partial, 1 ❌ Missing. Key gaps: missing submit progress modal, missing menu button in header, toolbar not floating |
| 2026-01-14 | src/apBoost/criteria_audit/section_1.5_to_1.9_criteria_audit.md | Created: Audit report for Sections 1.5-1.9 (Line Reader, Section Locking, Session Persistence, Instruction Screen, APDashboard). Results: 29 ✅ Implemented, 5 ⚠️ Partial, 11 ❌ Missing. Critical gaps: section locking not enforced (all 5 criteria missing), PAUSED status not set on browser close, line reader missing drag/scroll tracking, annotation restoration not wired up, max attempts not shown |
| 2026-01-14 | src/apBoost/criteria_audit/section_2.3.1_to_2.4_criteria_audit.md | Created: Audit report for Sections 2.3.1-2.5 (FRQ Sub-Question Navigation, FRQTextInput, SAQ, DBQ). Results: 17 ✅ Implemented, 2 ⚠️ Partial, 2 ❓ Unable to Verify. Key findings: FRQ sub-question navigation fully implemented with flat index approach, FRQTextInput meets all specs except explicit onBlur save, DBQ only supports single stimulus (not multiple documents). Recommendations: add onBlur save handler, implement multi-document support for DBQ |
| 2026-01-14 | src/apBoost/criteria_audit/section_3.1_to_3.4_criteria_audit.md | Created: Audit report for Sections 3.1-3.4 (Data Model: ap_tests, ap_stimuli, ap_questions, ap_session_state). Results: 40 ✅ Implemented, 6 ⚠️ Partial, 4 ❌ Missing, 1 ❓ Unable to Verify. Key gaps: frqMultipliers not implemented, ap_stimuli collection defined but no service created, rubric and tags fields missing from questions, totalTime calculation helper missing. Status uses IN_PROGRESS instead of ACTIVE (deviation from spec). |
| 2026-01-14 | src/apBoost/criteria_audit/section_3.5_to_3.8_criteria_audit.md | Created: Audit report for Sections 3.5-3.8 (Data Model: ap_test_results, ap_classes, ap_assignments, Firestore indexes). Results: 20 ✅ Implemented, 4 ⚠️ Partial, 11 ❌ Missing. Critical gaps: ALL 13 Firestore indexes missing from firestore.indexes.json, student access control not implemented for assignments. Minor issues: frqUploadedFiles/annotatedPdfUrl field names deviate from spec, maxAttempts defaults to 1 not 3, no createClass() function. Includes suggested index configuration JSON. |
| 2026-01-14 | src/apBoost/criteria_audit/section_4.1_to_4.5_criteria_audit.md | Created: Audit report for Sections 4.1-4.5 (Scoring System). Results: 12 ✅ Implemented, 2 ⚠️ Partial, 3 ❌ Missing. Score calculation flow and MCQ scoring fully implemented. Key gaps: MCQ_MULTI partial credit NOT implemented (partialCredit field exists but scoring logic ignores it), FRQ multipliers NOT implemented (frqMultiplier field doesn't exist), duplicate calculateAPScore function in apGradingService ignores test's custom scoreRanges. |
| 2026-01-14 | src/apBoost/criteria_audit/section_5.1_to_5.5_criteria_audit.md | Created: Audit report for Sections 5.1-5.5 (Session State Management: Core Sync, Write-Ahead Queue, Write Flow, Retry Strategy, Heartbeat System). Results: 28 ✅ Implemented, 12 ⚠️ Partial, 7 ❌ Missing, 1 ❓ Unable to Verify. Key gaps: beforeunload does NOT set PAUSED status (critical), navigation not immediate write, heartbeat doesn't trigger queue flush, opportunistic retry mode missing. Debounce is 1s not 2-3s spec. Strong offline foundation but missing integration between heartbeat and queue systems. |
| 2026-01-14 | src/apBoost/criteria_audit/section_5.9_to_5.12_criteria_audit.md | Created: Audit report for Sections 5.9-5.12 (Session Resume Flow, Conflict Resolution, Data Loss Protection, Edge Cases). Results: 8 Implemented, 9 Partial, 5 Missing. Critical gaps: queue reconciliation on resume missing (IndexedDB items not compared with Firestore timestamps), QuotaExceededError not handled, timer expiry auto-submit only logs (not implemented), PAUSED status never set. Duplicate tab detection fully working. |
| 2026-01-14 | src/apBoost/criteria_audit/section_8.1_to_8.6_criteria_audit.md | Created: Audit report for Sections 8.1-8.6 (FRQ Submission & Grading). Results: 52 Implemented, 11 Partial, 2 Missing. Key gaps: image compression before upload NOT implemented, InstructionScreen missing mode-specific FRQ instructions. Minor: AP Logo missing from PDF, annotatedPdfUrl field naming deviation. Teacher grading flow fully functional. |
| 2026-01-14 | src/apBoost/criteria_audit/section_11.1_to_11.5_criteria_audit.md | Created: Audit report for Sections 11.1-11.5 (Teacher Flow Pages: APTeacherDashboard, APTestEditor, APQuestionBank, AssignTestModal, APGradebook). Results: 29 Implemented, 5 Partial, 2 Missing. Key gaps: drag-to-reorder questions NOT implemented, individual student search missing in AssignTestModal, maxAttempts defaults to 1 not 3. Section reorder uses buttons not drag-and-drop. |
| 2026-01-14 | src/apBoost/criteria_audit/section_6.1_to_6.7_criteria_audit.md | Created: Audit report for Sections 6.1-6.7 (Error Handling). Results: 27 ✅ Implemented, 8 ⚠️ Partial, 3 ❌ Missing. APErrorBoundary and ErrorFallback fully meet spec. logError and withTimeout utilities properly implemented. Key gaps: validateSessionData function missing, several services use console.error instead of logError, silent catch blocks in analytics/grading services, no auth/permission or validation-specific user error messages. Services dont differentiate error types. |
| 2026-01-14 | src/apBoost/criteria_audit/section_16.1_to_16.6_criteria_audit.md | Created: Audit report for Sections 16.1-16.6 (Hooks Detailed: useTestSession, useHeartbeat, useDuplicateTabGuard, useTimer, useOfflineQueue, useAnnotations). Results: 39 Implemented, 9 Partial, 1 Missing. All 6 hooks exist with core functionality. Key gaps: navigation goes through queue (not immediate), heartbeat doesnt trigger queue flush, opportunistic retry mode missing after backoff exhaustion, IndexedDB name mismatch (ap_boost_queue vs ap_action_queue spec), CONFIRMED status skipped in queue flow. |
| 2026-01-14 | src/apBoost/criteria_audit/section_20.4_to_20.7_criteria_audit.md | Created: Audit report for Sections 20.4-20.7 (Phase Verification 5-7: Teacher Flow, FRQ Handwritten, Analytics). Results: 29 Implemented, 4 Partial, 0 Missing, 1 Unable to Verify. Phase 5 (Teacher Flow): dashboard, test editor, question bank, assignment modal all functional; question reordering via drag missing. Phase 6 (FRQ Handwritten): complete 4-step handwritten flow with PDF generation, file upload, grading panel viewer; annotated PDF student display needs verification. Phase 7 (Analytics): full analytics with filters, MCQ/FRQ grids, question detail modal, sortable student table, all PDF exports implemented. |
| 2026-01-14 | src/apBoost/criteria_audit/section_20.1_to_20.3_criteria_audit.md | Created: Audit report for Sections 19 (Seed Data) & 20.1-20.4 (Phase Verification 1-4). Results: 52 Implemented, 10 Partial, 4 Missing, 2 Unable to Verify. Key gaps in seed data: No FRQ test/section seeded (blocking Phase 3 testing), no mixed MCQ+FRQ test, no sample assignment document. Phase 1-4 verification mostly passes. All core flows (dashboard->instruction->test->review->submit->report card) working. Session resilience (offline queue, duplicate tab, resume) implemented. FRQ sub-question navigation working. Tools (highlighter, strikethrough, line reader) implemented. Recommendations: Add FRQ/mixed tests to seed data, enhance submit progress modal, verify cross-browser heartbeat timing. |
| 2026-01-14 | src/apBoost/criteria_audit/section_12.1_to_13.2_criteria_audit.md | Created: Audit report for Sections 12.1-13.2 (User Roles, Routes). Results: 18 Implemented, 7 Partial, 7 Missing, 1 Unable to Verify. Critical gaps: /ap/teacher/test/new route NOT defined (breaks Create Test button), Download Report PDF button missing from APReportCard, APStudentProfile and class management pages missing. Route discrepancies: gradebook at /ap/gradebook not /ap/teacher/gradebook, test editor has /edit suffix. No role-based access control - PrivateRoute only checks authentication. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_2.3.1_to_2.4_fix_plan.md | Created: Fix plan for Sections 2.3.1-2.5 (FRQ Sub-Question Nav, FRQTextInput, SAQ, DBQ). 4 issues analyzed: Issue 1 - FRQTextInput missing onBlur save handler (5-min fix: add onBlur prop); Issue 2 - DBQ multi-document support missing (15-20 min: add MultiStimulusDisplay component with tabs); Issues 3&4 - SAQ/DBQ manual grading verified as correctly implemented (no changes needed). Includes code snippets, verification steps, risk mitigations. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_2.1_to_2.3_fix_plan.md | Created: Fix plan for Sections 2.1-2.3 (Question Types: MCQ, MCQ_MULTI, FRQ). 6 issues analyzed - all related to MCQ_MULTI not being implemented at runtime. Issue 1: Add "Select all that apply" indicator in QuestionDisplay; Issue 2: Add questionType prop to AnswerInput with checkbox behavior for MCQ_MULTI (array-based selection); Issue 3: Multi-select storage (no changes needed - useTestSession already type-agnostic); Issue 4: correctAnswers array usage (resolved by Issues 2&5); Issue 5&6: Scoring - create calculateMCQMultiScore helper with partial credit formula and all-or-nothing mode. Implementation order: AnswerInput first, then indicator, then scoring. ~92 lines of changes across 4 files. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_1.1_to_1.4_fix_plan.md | Created: Comprehensive fix plan for Sections 1.1-1.4 (Timed Sections, Question Flagging, Highlighter, Strikethrough). 14 issues documented with detailed code analysis and implementation steps. Key fixes: timer auto-submit implementation (handleTimerExpire in useTestSession.js), mobile background detection via visibilitychange API, offline auto-submit queueing, FLAG_TOGGLE/ANNOTATION_UPDATE persistence in IndexedDB queue (read-modify-write pattern using arrayUnion/arrayRemove), flagged questions listing in ReviewScreen summary, ReviewQuestionModal for annotation viewing in review mode, overlapping highlights algorithm improvement, strikethrough X icon and opacity-60 styling updates. Includes implementation order, cross-cutting concerns (read-modify-write pattern, queue processing improvements), and verification checklists. Estimated complexity: Medium-High. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_4.1_to_4.5_fix_plan.md | Created: Fix plan for Sections 4.1-4.5 (Scoring System). 5 issues analyzed: Issue 1 - MCQ_MULTI all-or-nothing scoring (add arraysEqual helper, update calculateMCQScore with question type check); Issue 2 - MCQ_MULTI partial credit (implement (correct-incorrect)/total formula); Issue 3 - FRQ multipliers not implemented (discovered section.multiplier vs section.mcqMultiplier field mismatch, plan to unify); Issue 4 - Duplicate calculateAPScore in apGradingService ignores custom scoreRanges (remove duplicate, import from apScoringService). Implementation order: fix AP score bug first, then multiplier field mismatch, then MCQ_MULTI, finally FRQ multipliers. Estimated complexity: Medium-High. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_5.1_to_5.5_fix_plan.md | Created: Fix plan for Sections 5.1-5.5 (Session State: Core Sync, Write-Ahead Queue, Write Flow, Retry Strategy, Heartbeat System). 13 issues analyzed with detailed code paths. Key fixes: (1) change debounce from 1s to 2.5s, (2) add immediate write option for navigation, (3) implement SECTION_COMPLETE handler, (4) CRITICAL: add beforeunload PAUSED status via sendBeacon + Cloud Function, (5) complete missing action type handlers (ANNOTATION_*, STRIKETHROUGH_*, SESSION_*), (6) add opportunistic retry mode after backoff exhaustion, (7) add visibilitychange queue flush, (8) integrate heartbeat with queue via onRecovery callback. Implementation order and cross-cutting concerns documented. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_1.10_to_1.12_fix_plan.md | Created: Fix plan for Sections 1.10-1.12 (APTestSession, PassageDisplay, ToolsToolbar). 3 issues: (1) Submit Progress Modal missing - create SubmitProgressModal.jsx with sync progress, 30s timeout error handling, "Keep Trying" button; (2) Menu button missing in header - create TestSessionMenu.jsx with slide-up menu for instructions/navigation/exit; (3) ToolsToolbar not floating - add sticky top-0 z-10 inside scrollable container in PassageDisplay.jsx. Implementation order: ToolsToolbar (lowest risk) -> Menu button (medium) -> Submit modal (highest complexity). Files to create: SubmitProgressModal.jsx, TestSessionMenu.jsx. Files to modify: APTestSession.jsx, useTestSession.js, PassageDisplay.jsx. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_5.6_to_5.8_fix_plan.md | Created: Comprehensive fix plan for Sections 5.6-5.8 (Duplicate Tab Detection, Timer Behavior, Submit Flow). 9 issues documented (4 partial, 5 missing) with detailed code analysis. Section 5.6 (Duplicate Tab) fully implemented. Key fixes: Issue 1 - pauseSession function and beforeunload timer pause with PAUSED status; Issue 2 - mobile background timer pause with 30s visibilitychange threshold in useTimer; Issue 3 - optional user pause button with allowPause config; Issue 4 - InstructionScreen PAUSED status handling and startTest resume flow; Issues 5-9 - SyncingModal component with syncing/failed states after 30s, aggressive 2s flush retry during submit, "Unable to Sync" modal content with instructions and "Keep Trying" button. Implementation order provided with dependency tracking. Includes session status state machine (NOT_STARTED->IN_PROGRESS<->PAUSED->COMPLETED) and implementer notes on beforeunload reliability. Estimated complexity: Medium-High. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_20.4_to_20.7_fix_plan.md | Created: Fix plan for Sections 20.4-20.7 (Phase Verification 5-7: Teacher Flow, FRQ Handwritten, Analytics). 4 issues analyzed from audit. Key findings: Issues 1&3 (Create Questions, Annotated PDF Display) are FULLY IMPLEMENTED - audit just didn't verify them. Issue 2: Question reordering via drag not implemented - service exists (reorderSectionQuestions) but UI missing. Recommended Option A: up/down buttons matching section pattern (no new dependencies). Issue 4: Design token consistency in QuestionDetailModal - replace raw Tailwind colors (bg-green-50, text-green-700, etc.) with design tokens (bg-success, text-success-text-strong, etc.). Implementation order: Question reordering first (user-facing), then design tokens. Complexity: Medium. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_3.1_to_3.4_fix_plan.md | Created: Fix plan for Sections 3.1-3.4 (Data Model: ap_tests, ap_stimuli, ap_questions, ap_session_state). 11 issues with detailed code analysis: frqMultipliers for FRQ sections (apScoringService integration), totalTime calculation utility (new testHelpers.js), ap_stimuli service creation (new apStimuliService.js with CRUD), stimulus title field (additive change to PassageDisplay), stimulus/question tags fields, question rubric field (apQuestionService + APQuestionEditor), IN_PROGRESS vs ACTIVE status (recommend keeping current naming), answer object structure (recommend keeping separate flaggedQuestions array - cleaner separation of concerns). Includes stimulusId resolution in getTestWithQuestions(), implementation order based on dependencies. Estimated complexity: Medium. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_7.1_to_7.7_fix_plan.md | Created: Fix plan for Sections 7.1-7.7 (UI/UX). 10 issues analyzed: (1) Next button should show 'Review' on last question - add isLastQuestion prop to QuestionNavigator; (2) Review Screen missing timer header - add section info and TestTimer; (3) Flagged questions list missing in summary - compute and display like unanswered; (4) Reconnection message missing 'Reconnected' text and 2s auto-dismiss - add wasDisconnected/showReconnected state with timer; (5-6) Silent retry threshold VERIFIED as correctly implemented (MAX_FAILURES=3); (7) SubmitProgressModal missing - create new component with progress bar; (8) SubmitFailedModal missing - create 'Unable to sync' modal with 'Keep Trying' button; (9) Menu button missing - add hamburger menu dropdown; (10) Resizable divider deferred (optional). Files to create: SubmitProgressModal.jsx, SubmitFailedModal.jsx. Files to modify: QuestionNavigator.jsx, ReviewScreen.jsx, ConnectionStatus.jsx, APTestSession.jsx. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_16.1_to_16.6_fix_plan.md | Created: Fix plan for Sections 16.1-16.6 (Hooks: useTestSession, useHeartbeat, useDuplicateTabGuard, useTimer, useOfflineQueue, useAnnotations). 10 issues documented. Key fixes: (1) Missing opportunistic mode in useOfflineQueue - add isOpportunisticMode state, enter after 3 failures, retry on user action; (2) Missing visibility change flush - add visibilitychange listener; (3) Navigation not immediate - add immediate flag to addToQueue; (4/10) Heartbeat-queue integration - add onSuccess callback to useHeartbeat; (5) IndexedDB name mismatch - rename ap_boost_queue to ap_action_queue; (6) CONFIRMED status in queue flow - defer to Phase 2; (8) saveAnnotations function - add explicit function. Prioritized implementation order. Complexity: Medium. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_5.9_to_5.12_fix_plan.md | Created: Comprehensive fix plan for Sections 5.9-5.12 (Session Resume, Conflict Resolution, Data Loss Protection, Edge Cases). 9 issues (5 missing, 9 partial). Critical fix: Queue Reconciliation on Resume - add reconcileQueue() in useOfflineQueue to compare IndexedDB timestamps vs Firestore lastAction, discard stale items, keep newer. Other fixes: QuotaExceededError handling with isStorageFull state/retry/UI banner; Timer Expiry Auto-Submit with AUTO_SUBMIT action and offline queue support; beforeunload warning expansion (warn on IN_PROGRESS not just queue>0); local timestamp ordering in queue flush; extended offline duration warning (5+ min); Firestore quota error detection; IndexedDB onabort handler. Cross-cutting utilities: timestampUtils.js (toMillis, compareTimestamps), errorUtils.js (isQuotaError, isNetworkError). Implementation order prioritizes quick wins before complex reconciliation. Complexity: High. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_20.1_to_20.3_fix_plan.md | Created: Fix plan for Sections 20.1-20.3 (Seed Data & Phase Verification 1-4). 9 issues analyzed (4 missing, 4 partial, 1 unable to verify). Seed data fixes: add FRQ test with subQuestions array (test_apush_frq_practice_1), add mixed MCQ+FRQ test (test_apush_full_exam), add ap_classes/ap_assignments sample documents. Phase verification fixes: submit sync progress UI (isSyncing/queueLength to ReviewScreen), heartbeat timing verified correct (15s), APReportCard real-time score updates via onSnapshot listener, annotations in review mode via QuestionBox indicators. Implementation order: seed data first, then real-time scores, sync progress, review annotations. Complexity: Medium. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_19.1_to_19.10_fix_plan.md | Created: Fix plan for Sections 19.1-19.10 (Utilities Detailed). 11 issues documented: (1) Subject constants location - add AP_SUBJECT to apTypes.js; (2) Subject default time limits - add defaultTimeLimits to AP_SUBJECTS; (3) Score ranges location - move DEFAULT_SCORE_RANGES to apTestConfig.js with re-export; (4) logError sessionId/userId extraction - extract to top-level; (5) AP logo in answer sheet PDF - add loadImageAsBase64 helper and embed logo from /public/apBoost/; (6-7) PDF return types - change generateReportPdf and generateQuestionsPdf to return Blob; (8) Section type configurations - add SECTION_TYPE_CONFIG to apTestConfig.js; (9) CRITICAL: validateSession.js missing - create with validateSessionData, validateSessionForResume, isSessionStale functions; (10) HEIC conversion - create imageProcessing.js with heic2any integration (dynamic import for bundle size); (11) Image compression - add compressImage to imageProcessing.js with canvas resize. Implementation order and cross-cutting concerns documented (imageProcessing.js combines issues 10&11). Estimated complexity: Medium. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_14.1_to_14.4_fix_plan.md | Created: Fix plan for Sections 14.1-14.4 (Architecture & Integration). 4 issues analyzed: Issue 1 (MISSING) - No UI component imports from ../components/ui/ - 82 button elements across 28 files, 4 modal components should reuse vocaBoost Modal/Button; Issue 2 (PARTIAL) - 8 services import from ../../firebase instead of ../../services/db (missing retry utilities); Issue 3 (PARTIAL) - performanceColors.js uses raw Tailwind colors (bg-green-500 etc.) - plan creates performance design tokens; Issue 4 (PARTIAL) - ThemeContext not actively used but CSS variables work correctly (acceptable as-is). Implementation order: tokens first, then service imports, then UI components (largest scope). Includes button variant mapping guide and file lists. Estimated complexity: Medium-High due to 28-file button refactoring. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_17.1_to_17.6_fix_plan.md | Created: Fix plan for Sections 17.1-17.6 (Hooks Detailed: useTestSession, useHeartbeat, useDuplicateTabGuard, useTimer, useOfflineQueue, useAnnotations). 12 issues analyzed with detailed code paths. HIGH PRIORITY: ANNOTATION_UPDATE not handled in flushQueue (annotations/strikethroughs lost), FLAG_TOGGLE has placeholder only (flags lost) - need arrayUnion/arrayRemove imports. MEDIUM: Add visibilitychange queue flush, heartbeat-triggered flush via useTestSession coordination, opportunistic retry mode after backoff exhaustion, HighlightRange type validation. LOW/DOC: IndexedDB name (keep current), CONFIRMED status skipped (acceptable), navigation queued (acceptable with beforeunload), 1s debounce (within spec), saveAnnotations naming (add alias). Issue 12 (Firestore token check) confirmed working as designed via useHeartbeat->useTestSession coordination. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/section_8.1_to_8.6_fix_plan.md | Created: Fix plan for Sections 8.1-8.6 (FRQ Submission & Grading). 10 issues analyzed: (1) Student FRQ mode choice - document as design decision (teacher control is intentional); (2) InstructionScreen missing FRQ mode-specific instructions - add typed vs handwritten info box; (3) Answer sheet PDF missing AP logo - add logo image with fallback; (4) PDF stimulus truncation/no images - remove 500 char limit, add image support with CORS handling; (5) Image compression before upload MISSING - create imageCompression.js utility with canvas-based compression; (6) Client-side preview before upload - add local preview URLs using createObjectURL; (7) PDF viewer container fit - minor CSS tweak; (8) Graded PDF path timestamp - document as feature (version history); (9) annotatedPdfUrl field name - recommend keeping (more descriptive than spec); (10) frqUploadedFiles vs frqUploadUrl - document as enhancement (multi-file support). Implementation order and cross-cutting concerns documented. Estimated complexity: Medium. |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__01__1.1_to_1.4.md | Created: Comprehensive codebase facts report for sections 1.1-1.4. Documents canonical data schema (SESSION_STATUS, flaggedQuestions as Set/Array, annotations Map structure, sectionTimeRemaining), write paths (direct Firestore writes vs offline queue, FLAG_TOGGLE/ANNOTATION_UPDATE not actually persisted), offline mechanics (IndexedDB ap_boost_queue with exponential backoff retry), UI entry points (timer start/pause, review mode, strikethrough button), and 12 must-answer questions with evidence. Key findings: handleTimerExpire only logs (no auto-submit), mobile backgrounding threshold NOT implemented, beforeunload only warns (no PAUSED status), FLAG_TOGGLE has empty case in flushQueue, ReviewScreen shows count-only for flagged (no Q# list). |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__05__5.6_to_5.8.md | Created: Codebase facts report for sections 5.6-5.8 (Timer pause, mobile background, pause button, resume flow, submit sync UX, flush retry). Documents SESSION_STATUS.PAUSED (defined but NEVER used/written/queried), sectionTimeRemaining shape ({ sectionId: seconds }), beforeunload handler (warning only - no PAUSED write, no sendBeacon), flushQueue retry (exponential 2/4/8/16s, max 5), submit ordering (flushQueue→createTestResult with race condition risk if already flushing), no SyncingModal component, no visibilitychange timer pause, no allowPause config, getActiveSession queries IN_PROGRESS only. 10 must-answer questions with full evidence. |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__16.1_to_16.6.md | Created: Comprehensive codebase facts report for sections 16.1-16.6 (Components/Hooks List). Documents useOfflineQueue (retry limit 5, backoff 2/4/8/16s, no opportunistic mode, ap_boost_queue DB name, PENDING→deleted lifecycle), flush triggers (online event only, NO visibilitychange/heartbeat flush), navigation writes (ALWAYS queued via addToQueue, updatePosition never called), heartbeat (15s interval, MAX_FAILURES=3, no queue integration), useDuplicateTabGuard (BroadcastChannel + Firestore dual-layer), useAnnotations (no saveAnnotations(), uses exportAnnotations, ANNOTATION_UPDATE queued but NOT persisted). 10 must-answer questions with evidence. |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__8.1_to_8.6.md | Created: Comprehensive codebase facts report for sections 8.1-8.6 (FRQ Submission & Grading scope). Documents assignment schema (frqSubmissionType stored, NO allowStudentChoice field, default 'TYPED'), result schema (frqUploadedFiles array NOT frqUploadUrl string, annotatedPdfUrl NOT frqGradedPdfUrl), FRQ_SUBMISSION_TYPE enum (TYPED/HANDWRITTEN), stimulus schema (type/content/source/imageUrl), upload file shape. Write paths: storage paths for uploads and graded PDFs. Key gaps: InstructionScreen NO frqSubmissionType handling, student choice UI IGNORES assignment setting, PDF generation TRUNCATES stimulus (500 chars) and has NO image/logo support, FileUpload NO pre-upload previews, NO image compression, HandwrittenViewer uses object-contain NOT width-fit. 12 must-answer questions with full evidence. |
| 2026-01-14 | src/apBoost/criteria_audit/CODEBASE_FACTS__UNK__18.1_to_18.8.md | Created: Codebase facts report for sections 18.1-18.8 (Utilities Detailed). Documents AP_SUBJECTS (apTestConfig.js:5-66, shape: id/name/shortName/color, NO defaultTimeLimits), DEFAULT_SCORE_RANGES (apTypes.js:81-87), SECTION_TYPE (apTypes.js:27-31, simple enum only), SESSION_STATUS (apTypes.js:34-39). NO circular imports between apTestConfig/apTypes. Session services return raw Firestore data with NO validation/sanitization. logError is console-only with signature (functionName, context, error). logWarning EXISTS at logError.js:42-53. validateSession.js does NOT exist. PDF return type INCONSISTENCY: generateAnswerSheetPdf returns Blob, generateReportPdf/generateQuestionsPdf return jsPDF doc. No logos embedded in PDFs (addImage not used). 9 public/apBoost/ logo assets available. downloadReportPdf/downloadQuestionsPdf NOT called from UI. 12 must-answer questions with evidence. |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/CODEBASE_FACTS__UNK__1.10_to_1.12.md | Created: Codebase facts report for sections 1.10-1.12 (Submit Progress Modal, Header Menu, ToolsToolbar Sticky). Documents canonical data schema (isSubmitting hook state, IndexedDB queue, Firestore ap_session_states), write paths (submitTest sequence: guard→setIsSubmitting→timer.pause→flushQueue→createTestResult), offline mechanics (exponential backoff 2/4/8/16s, max 5 retries, NO submission-level retry/timeout), UI entry points (header line 402-411 with NO menu button, ReviewScreen submit button shows spinner/"Submitting...", ToolsToolbar OUTSIDE scroll container in PassageDisplay). Key findings: NO progress modal during submit, NO header menu/hamburger, toolbar cannot be sticky due to placement outside overflow-auto container, z-50 is standard modal z-index convention. 12 must-answer questions with full evidence. |
| 2026-01-14 | src/apBoost/hooks/useOfflineQueue.js | Implemented FLAG_TOGGLE idempotent flush using Firestore transaction with last-write-wins per questionId |
| 2026-01-14 | src/apBoost/hooks/useOfflineQueue.js | Implemented ANNOTATION_UPDATE flush with transaction handling ADD_HIGHLIGHT, REMOVE_HIGHLIGHT, CLEAR_HIGHLIGHTS, TOGGLE_STRIKETHROUGH, CLEAR_STRIKETHROUGHS, CLEAR_ALL |
| 2026-01-14 | src/apBoost/hooks/useOfflineQueue.js | Added getPendingItems() and deleteItems() helper functions for queue management |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Wired loadAnnotations to restore annotations/strikethroughs from session on resume |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Added auto-submit navigation effect for timer expiry |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Implemented handleTimerExpire with actual submission logic, single-flight protection, and AUTO_SUBMIT queueing for offline |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added autoSubmitTriggered/autoSubmitResultId state and submitFunctionsRef for timer expiry handling |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added checkPendingAutoSubmit effect for offline timer expiry + submit on reconnect |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added visibilitychange handler with 30s threshold for mobile backgrounding timer pause |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added pagehide handler for reliable timer sync on mobile Safari |
| 2026-01-14 | src/apBoost/components/ReviewScreen.jsx | Added flagged questions list to summary (shows Q# like unanswered) |
| 2026-01-14 | src/apBoost/components/tools/Highlighter.jsx | Replaced segment builder with boundary-sweep algorithm to fix overlapping highlight truncation |
| 2026-01-14 | src/apBoost/components/AnswerInput.jsx | Changed strikethrough icon from plus to X, updated styling to opacity-[0.6] and text-text-muted |
| 2026-01-14 | src/apBoost/services/apSessionService.js | Updated getActiveSession query to include PAUSED status: `where('status', 'in', [SESSION_STATUS.IN_PROGRESS, SESSION_STATUS.PAUSED])` |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added pause marker logic: write localStorage marker on pagehide/visibilitychange, apply PAUSED status on restore, resume to IN_PROGRESS |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Added section lock visual indicator in header (lock icon + "Locked" text when in section 2+) |
| 2026-01-14 | src/apBoost/components/tools/LineReader.jsx | Added scroll tracking (scrollTop state + scroll listener), drag interaction via Pointer Events API, scroll-relative positioning |
| 2026-01-14 | src/apBoost/pages/APDashboard.jsx | Added max attempts display ("Attempts: X / Y"), enforcement (disabled when maxed), warning status styling |
| 2026-01-14 | src/apBoost/criteria_audit/fix_plans/AP_BOOST_IMPLEMENTATION_LOG.md | Updated Section 1.5-1.9 status to COMPLETE (5/5 issues), documented all key changes and patterns |
| 2026-01-14 | src/apBoost/components/tools/PassageDisplay.jsx | Made ToolsToolbar sticky within scroll container (sticky top-0 z-10 bg-surface) |
| 2026-01-14 | src/apBoost/components/TestSessionMenu.jsx | Created slide-up menu component with "Go to Question..." and "Exit Test" (with confirmation) actions |
| 2026-01-14 | src/apBoost/components/QuestionNavigator.jsx | Added controlled mode support (isOpen/onOpenChange props) for external menu integration |
| 2026-01-14 | src/apBoost/components/SubmitProgressModal.jsx | Created submission progress modal with syncing state, queue count display, 30s timeout handling, and "Keep Trying" button |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added submission retry state machine: submitError, isSubmitTimedOut, submitStartTimeRef, pendingFrqDataRef states |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Enhanced submitTest() with 2s retry loop and 30s timeout, added retrySubmit() for manual "Keep Trying" |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Added hamburger menu button to header with SVG icon |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Integrated TestSessionMenu with showMenu state and navigator open callback |
| 2026-01-14 | src/apBoost/pages/APTestSession.jsx | Integrated SubmitProgressModal with queueLength, isSyncing, isSubmitTimedOut, and handleRetry |
| 2026-01-14 | src/apBoost/services/apQuestionService.js | Added rubric and tags fields to createQuestion() and tag filtering to searchQuestions() with array-contains query |
| 2026-01-14 | src/apBoost/pages/APQuestionEditor.jsx | Added rubric textarea (FRQ types only) and tags input (comma-separated) with save/load support |
| 2026-01-14 | src/apBoost/services/apScoringService.js | Implemented frqMaxPoints calculation with frqMultipliers support in createTestResult() |
| 2026-01-14 | src/apBoost/services/apGradingService.js | Updated calculateFRQScore() to accept frqMultipliers parameter, saveGrade() now fetches test to apply multipliers |
| 2026-01-14 | src/apBoost/services/apStimuliService.js | Created new stimuli service with getStimulusById, getStimuliByIds (batch), searchStimuli, createStimulus, updateStimulus, deleteStimulus |
| 2026-01-14 | src/apBoost/services/apTestService.js | Added stimulusId resolution in getTestWithQuestions() - fetches shared stimuli and attaches to questions |
| 2026-01-14 | src/apBoost/components/tools/PassageDisplay.jsx | Added title rendering for stimulus (displays above content for both image and text types) |
| 2026-01-14 | src/apBoost/utils/seedTestData.js | Added title and tags to stimulus example in seed data |
| 2026-01-14 | src/apBoost/utils/apTypes.js | Added ACTIVE alias to SESSION_STATUS (maps to IN_PROGRESS for spec compatibility) |
| 2026-01-14 | firestore.indexes.json | Added 6 AP-specific indexes: ap_session_state, ap_tests, ap_classes, ap_assignments, ap_test_results (2 indexes for grading with/without teacherId filter) |
| 2026-01-14 | src/apBoost/services/apTestService.js | Fixed isPublic→isPublished mismatch in getAvailableTests() query (was querying wrong field) |
| 2026-01-14 | src/apBoost/services/apTestService.js | Added canAccessTest() function for authorization check (returns {allowed, reason, assignmentId}) |
| 2026-01-14 | src/apBoost/services/apSessionService.js | Added access control check in createOrResumeSession() using canAccessTest(), blocks unauthorized test access |
| 2026-01-14 | src/apBoost/hooks/useTestSession.js | Added access control check in loadTestAndSession() before loading test content, prevents unauthorized URL access |
| 2026-01-14 | src/apBoost/services/apGradingService.js | Added teacherId filter to getPendingGrades() for teacher isolation - teachers only see their own students' results |
| 2026-01-14 | src/apBoost/services/apGradingService.js | Added frqGradedPdfUrl alias field when saving annotatedPdfUrl for spec compatibility |
| 2026-01-14 | src/apBoost/components/teacher/AssignTestModal.jsx | Fixed maxAttempts default from 1→3 per spec |
| 2026-01-14 | src/apBoost/services/apTeacherService.js | Fixed maxAttempts fallback from \|\|1 to ??3 for safer handling and spec compliance |
| 2026-01-14 | src/apBoost/services/apScoringService.js | Added frqUploadUrl and frqGradedPdfUrl alias fields in createTestResult() for spec compatibility |
| 2026-01-14 | firestore.rules | Tightened ap_test_results update rule: teachers can only update results where resource.data.teacherId == request.auth.uid |
