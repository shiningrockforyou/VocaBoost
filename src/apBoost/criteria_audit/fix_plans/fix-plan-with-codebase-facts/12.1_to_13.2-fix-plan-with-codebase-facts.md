# Section 12.1 to 13.2 - Fix Plan with Codebase Facts

> **What is this file?**
> This document combines two resources for implementing criteria section 12.1 to 13.2:
> 1. **Fix Plan** - Step-by-step implementation instructions for code changes
> 2. **Codebase Facts** - Relevant code snippets, file paths, and existing patterns from the codebase
>
> Use the Fix Plan as your guide and reference the Codebase Facts for accurate file locations and code context.

---

## Part 1: Fix Plan

# Fix Plan: Sections 12.1 to 13.2

**Planned by:** Claude Agent
**Date:** 2026-01-14
**Status:** COMPLETE
**Based on Audit:** section_12.1_to_13.2_criteria_audit.md

## Executive Summary
- Total Issues: 14
- Verified as Implemented: 1 (ScoreRangesEditor - audit was incomplete)
- ⚠️ Partial Implementations: 6
- ❌ Missing Features: 6
- ❓ Needs Investigation: 1
- Estimated Complexity: High

---

## Issue 1: Missing Download Report PDF Button (12.1)

### Audit Finding
- **Status:** ❌ Missing
- **Criterion:** Students can download score reports as PDF
- **Current State:** `generateReportPdf.js` utility exists with full implementation but is NOT imported or used in APReportCard.jsx

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/utils/generateReportPdf.js` (lines 1-263) - Complete PDF generation utility with `downloadReportPdf` export
  - `src/apBoost/pages/APReportCard.jsx` (lines 497-505) - Actions section only has "Back to Dashboard" button
- **Current Implementation:** The utility is fully implemented:
  - `generateReportPdf(result, test, student)` - Creates jsPDF document
  - `downloadReportPdf(result, test, student)` - Saves PDF with filename
- **Gap:** No import statement for utility, no download button in UI
- **Dependencies:** jsPDF library (already installed per import in utility)

### Fix Plan

#### Step 1: Add import to APReportCard.jsx
**File:** `src/apBoost/pages/APReportCard.jsx`
**Action:** Modify - Add import at top of file
**Details:**
- Add import: `import { downloadReportPdf } from '../utils/generateReportPdf'`
- Place after existing imports (after line 8)

#### Step 2: Add download handler function
**File:** `src/apBoost/pages/APReportCard.jsx`
**Action:** Modify - Add handler inside component
**Details:**
- Add after line 340 (after grading status checks):
```jsx
// Handle PDF download
const handleDownloadPdf = async () => {
  try {
    await downloadReportPdf(result, test, {
      name: user?.displayName || user?.email || 'Student',
      email: user?.email,
    })
  } catch (err) {
    console.error('Failed to download PDF:', err)
  }
}
```

#### Step 3: Add download button to Actions section
**File:** `src/apBoost/pages/APReportCard.jsx`
**Action:** Modify - Add button in actions div (line 498-505)
**Details:**
- Add before "Back to Dashboard" link:
```jsx
<button
  onClick={handleDownloadPdf}
  className="bg-brand-primary text-white px-6 py-2 rounded-[--radius-button] hover:opacity-90 transition-colors"
>
  Download Report PDF
</button>
```

### Verification Steps
1. Navigate to `/ap/results/:resultId`
2. Click "Download Report PDF" button
3. Verify PDF downloads with correct filename format
4. Open PDF and verify content matches on-screen report

### Potential Risks
- Low risk: PDF generation is synchronous and uses existing data
- Consider adding loading state for download button if needed

---

## Issue 2: Customize Score Ranges UI (12.2)

### Audit Finding
- **Status:** ⚠️ Partial (per audit)
- **Criterion:** Teachers can customize score ranges for AP conversion
- **Current State:** Audit claimed no UI found

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/pages/APTestEditor.jsx` (lines 156-197) - `ScoreRangesEditor` component EXISTS
  - `src/apBoost/pages/APTestEditor.jsx` (lines 496-500) - Component IS rendered
- **Current Implementation:** FULLY IMPLEMENTED
  - ScoreRangesEditor component with 5 AP score range inputs
  - State managed by `scoreRanges` state variable (line 214)
  - Passed to `onChange={setScoreRanges}` handler

### Fix Plan
**NO FIX NEEDED** - This was incorrectly flagged in the audit. The ScoreRangesEditor is fully implemented at lines 156-197 and rendered at lines 496-500.

### Verification Steps
1. Navigate to `/ap/teacher/test/:testId/edit`
2. Scroll to "Score Ranges" section
3. Verify 5 AP score inputs (AP 5-1) with min/max percentage fields
4. Modify values and verify they persist on save

---

## Issue 3: Create and Manage Classes Page (12.2)

### Audit Finding
- **Status:** ⚠️ Partial
- **Criterion:** Teachers can create and manage classes
- **Current State:** Classes displayed in dashboard sidebar but no dedicated management page

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/pages/APTeacherDashboard.jsx` (lines 296-311) - Classes list in sidebar
  - `src/apBoost/services/apTeacherService.js` (lines 160-178) - `getTeacherClasses` exists
  - `src/apBoost/routes.jsx` - No class management route
- **Current Implementation:**
  - Classes are fetched and displayed as read-only list
  - No create/edit/delete functionality
  - ClassItem component only displays name, period, student count
- **Gap:** Need APClassManager page with CRUD operations
- **Dependencies:** Need new service functions for class CRUD

### Fix Plan

#### Step 1: Create apClassService.js
**File:** `src/apBoost/services/apClassService.js`
**Action:** Create new file
**Details:**
- Create service with functions:
  - `createClass(teacherId, classData)` - Create new class
  - `updateClass(classId, classData)` - Update class details
  - `deleteClass(classId)` - Delete class
  - `addStudentsToClass(classId, studentIds)` - Add students
  - `removeStudentFromClass(classId, studentId)` - Remove student
  - `getClassStudents(classId)` - Fetch student details
- Follow patterns from `apTeacherService.js`

#### Step 2: Create APClassManager.jsx
**File:** `src/apBoost/pages/APClassManager.jsx`
**Action:** Create new page
**Details:**
- Page layout with APHeader
- Class list with edit/delete actions
- "Create Class" button opening modal/form
- Class form with: name, period, year fields
- Student management section (add/remove students)
- Follow patterns from APTestEditor.jsx for form handling

#### Step 3: Add route for class management
**File:** `src/apBoost/routes.jsx`
**Action:** Modify - Add new route
**Details:**
- Add import: `import APClassManager from './pages/APClassManager'`
- Add routes:
```jsx
<Route
  path="/ap/teacher/classes"
  element={
    <PrivateRoute>
      <APClassManager />
    </PrivateRoute>
  }
/>
<Route
  path="/ap/teacher/class/:classId"
  element={
    <PrivateRoute>
      <APClassManager />
    </PrivateRoute>
  }
/>
```

#### Step 4: Update dashboard "My Classes" section
**File:** `src/apBoost/pages/APTeacherDashboard.jsx`
**Action:** Modify - Add link to class management
**Details:**
- Add "Manage Classes" link in My Classes section header (line 298)
- Update ClassItem to link to `/ap/teacher/class/:classId`

### Verification Steps
1. Navigate to `/ap/teacher/classes`
2. Create a new class
3. Add students to class
4. Edit class details
5. Remove student from class
6. Delete class

### Potential Risks
- Medium complexity: Requires new service layer and full CRUD page
- Need to handle student lookup/search for adding students

---

## Issue 4: Export Questions/Reports PDF Buttons (12.2)

### Audit Finding
- **Status:** ⚠️ Partial
- **Criterion:** Teachers can export questions and reports as PDFs
- **Current State:** Utilities exist but no UI buttons to trigger them

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/utils/generateQuestionsPdf.js` - Complete utility with options
  - `src/apBoost/pages/APTestEditor.jsx` - Test editing page (best location for questions PDF)
  - `src/apBoost/pages/APExamAnalytics.jsx` - Analytics page (location for reports)
- **Current Implementation:**
  - `generateQuestionsPdf(test, questions, options)` - Creates PDF
  - `downloadQuestionsPdf(test, questions, options)` - Downloads PDF
  - Options: `{ includeAnswers: boolean, includeStimuli: boolean }`
- **Gap:** No buttons wired up in UI

### Fix Plan

#### Step 1: Add PDF export to APTestEditor
**File:** `src/apBoost/pages/APTestEditor.jsx`
**Action:** Modify
**Details:**
- Add import: `import { downloadQuestionsPdf } from '../utils/generateQuestionsPdf'`
- Add export handler:
```jsx
const handleExportPdf = async (includeAnswers = false) => {
  await downloadQuestionsPdf(
    { title, subject, sections },
    questionsCache,
    { includeAnswers, includeStimuli: true }
  )
}
```
- Add dropdown or button group in header section (near "Save Draft"):
```jsx
<div className="relative">
  <button className="px-4 py-2 border ...">Export PDF</button>
  <div className="dropdown-menu">
    <button onClick={() => handleExportPdf(false)}>Student Version</button>
    <button onClick={() => handleExportPdf(true)}>Teacher Version (with answers)</button>
  </div>
</div>
```

#### Step 2: Add report export to APExamAnalytics (optional enhancement)
**File:** `src/apBoost/pages/APExamAnalytics.jsx`
**Action:** Modify
**Details:**
- Add export functionality for analytics summary PDF
- Lower priority than questions PDF

### Verification Steps
1. Navigate to `/ap/teacher/test/:testId/edit`
2. Click "Export PDF" dropdown
3. Download "Student Version" - verify no answers shown
4. Download "Teacher Version" - verify answers highlighted

### Potential Risks
- Low risk: Utility already tested and complete
- May need loading indicator for large tests

---

## Issue 5: Admin Question Bank Access (12.3)

### Audit Finding
- **Status:** ❓ Unable to Verify
- **Criterion:** Admins can manage question bank
- **Current State:** No explicit admin role check for question bank

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/pages/APQuestionBank.jsx` - Question bank page
  - `src/components/PrivateRoute.jsx` - Only checks authentication, not roles
  - `src/contexts/AuthContext.jsx` (lines 37-43) - User object DOES have role property
- **Current Implementation:**
  - User role is loaded from Firestore (`role: userData.role ?? 'student'`)
  - PrivateRoute does not check role
  - No admin-specific UI or permissions
- **Gap:** Need role-based access control for admin features

### Fix Plan

#### Step 1: Create RoleProtectedRoute component
**File:** `src/apBoost/components/RoleProtectedRoute.jsx`
**Action:** Create new component
**Details:**
```jsx
import { Navigate } from 'react-router-dom'
import { useAuth } from '../../contexts/AuthContext'

export default function RoleProtectedRoute({
  children,
  allowedRoles = [],
  fallback = '/ap'
}) {
  const { user, initializing } = useAuth()

  if (initializing) {
    return <div>Loading...</div>
  }

  if (!user) {
    return <Navigate to="/login" replace />
  }

  // Check if user has required role
  const userRole = user.role || 'student'

  // Admin has access to everything
  if (userRole === 'admin') {
    return children
  }

  // Check if user's role is in allowed list
  if (!allowedRoles.includes(userRole)) {
    return <Navigate to={fallback} replace />
  }

  return children
}
```

#### Step 2: Update routes.jsx to use RoleProtectedRoute
**File:** `src/apBoost/routes.jsx`
**Action:** Modify - Protect teacher routes
**Details:**
- Import: `import RoleProtectedRoute from './components/RoleProtectedRoute'`
- Wrap teacher routes:
```jsx
<Route
  path="/ap/teacher"
  element={
    <RoleProtectedRoute allowedRoles={['teacher', 'admin']}>
      <APTeacherDashboard />
    </RoleProtectedRoute>
  }
/>
```
- Apply to all `/ap/teacher/*` routes

### Verification Steps
1. Log in as student - verify cannot access `/ap/teacher`
2. Log in as teacher - verify can access `/ap/teacher`
3. Log in as admin - verify can access all routes

### Potential Risks
- Breaking change: May lock out users if roles not properly set in Firestore
- Mitigation: Default to 'student' role if not set

---

## Issue 6: Create Public Tests Admin UI (12.3)

### Audit Finding
- **Status:** ⚠️ Partial
- **Criterion:** Admins can create public tests (isPublic: true)
- **Current State:** `isPublic` field exists in data model but no UI to set it

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/utils/seedTestData.js` (line 26) - `isPublic: true` used in seed
  - `src/apBoost/services/apTestService.js` (line 27) - Queries public tests
  - `src/apBoost/pages/APTestEditor.jsx` - No isPublic toggle
- **Current Implementation:**
  - Data model supports `isPublic` field
  - No UI to toggle it
- **Gap:** Need checkbox/toggle in APTestEditor (admin-only)

### Fix Plan

#### Step 1: Add isPublic toggle to APTestEditor
**File:** `src/apBoost/pages/APTestEditor.jsx`
**Action:** Modify
**Details:**
- Add state: `const [isPublic, setIsPublic] = useState(false)`
- Load from test data in useEffect (line 244): `setIsPublic(test.isPublic || false)`
- Add to testData in handleSave (line 365): `isPublic,`
- Add toggle in UI (visible only to admins):
```jsx
{user?.role === 'admin' && (
  <div className="flex items-center gap-2 mt-4">
    <input
      type="checkbox"
      id="isPublic"
      checked={isPublic}
      onChange={(e) => setIsPublic(e.target.checked)}
      className="rounded border-border-default"
    />
    <label htmlFor="isPublic" className="text-text-secondary text-sm">
      Make this test public (visible to all students)
    </label>
  </div>
)}
```

### Verification Steps
1. Log in as admin
2. Edit test - verify isPublic checkbox visible
3. Enable isPublic and save
4. Verify test appears in student dashboard without assignment

### Potential Risks
- Low risk: Simple boolean toggle
- Consider: Warning message about public visibility

---

## Issue 7: Missing /ap/test/:testId/review Route (13.1)

### Audit Finding
- **Status:** ❌ Missing
- **Criterion:** /ap/test/:testId/review → APTestReview (quick view after submit)
- **Current State:** Review is inline view state within APTestSession

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/pages/APTestSession.jsx` (line 45) - `view` state includes 'review'
  - `src/apBoost/components/ReviewScreen.jsx` - Review component
- **Current Implementation:**
  - ReviewScreen is rendered inline when `view === 'review'`
  - No separate route/page
- **Gap:** May want dedicated route for direct linking/bookmarking

### Fix Plan

#### Option A: Add route that maps to APTestSession with review state
**File:** `src/apBoost/routes.jsx`
**Action:** Modify - Add review route
**Details:**
```jsx
<Route
  path="/ap/test/:testId/review"
  element={
    <PrivateRoute>
      <APTestSession initialView="review" />
    </PrivateRoute>
  }
/>
```
- Update APTestSession to accept `initialView` prop and set initial state

#### Option B: Create separate APTestReview page (if needed for different functionality)
**File:** `src/apBoost/pages/APTestReview.jsx`
**Action:** Create new page
**Details:**
- Page that loads session and displays review screen
- May redirect to results if test already submitted

### Recommended Approach: Option A (simpler)

#### Step 1: Modify APTestSession to accept initialView prop
**File:** `src/apBoost/pages/APTestSession.jsx`
**Action:** Modify
**Details:**
- Change line 45:
```jsx
const [view, setView] = useState(initialView || 'instruction')
```
- Add prop destructuring: `function APTestSession({ initialView = 'instruction' })`

#### Step 2: Add route
**File:** `src/apBoost/routes.jsx`
**Action:** Modify
**Details:**
```jsx
<Route
  path="/ap/test/:testId/review"
  element={
    <PrivateRoute>
      <APTestSession initialView="review" />
    </PrivateRoute>
  }
/>
```

### Verification Steps
1. Navigate directly to `/ap/test/:testId/review`
2. Verify review screen is displayed
3. Verify navigation still works

### Potential Risks
- May need to handle edge cases (test not started, test already submitted)
- Consider redirecting to results if already submitted

---

## Issue 8: Gradebook Route Path Discrepancy (13.2)

### Audit Finding
- **Status:** ⚠️ Partial (Different Path)
- **Criterion:** /ap/teacher/gradebook → APGradebook
- **Current State:** Route is `/ap/gradebook` (missing /teacher)

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/routes.jsx` (lines 91-98) - Route is `/ap/gradebook`
  - `src/apBoost/pages/APTeacherDashboard.jsx` (lines 228, 287) - Links to `/ap/gradebook`
- **Current Implementation:** Path works but doesn't match criteria pattern

### Fix Plan

#### Step 1: Update route path
**File:** `src/apBoost/routes.jsx`
**Action:** Modify
**Details:**
- Change line 92: `path="/ap/teacher/gradebook"`
- Add RoleProtectedRoute wrapper for teacher access

#### Step 2: Update all links to gradebook
**File:** `src/apBoost/pages/APTeacherDashboard.jsx`
**Action:** Modify
**Details:**
- Line 228: Change `to="/ap/gradebook"` to `to="/ap/teacher/gradebook"`
- Line 287: Change `to="/ap/gradebook"` to `to="/ap/teacher/gradebook"`

### Verification Steps
1. Navigate to `/ap/teacher/gradebook`
2. Verify page loads
3. Verify dashboard links work

### Potential Risks
- Low risk: Simple path rename
- Update any other references to old path

---

## Issue 9: Missing /ap/teacher/gradebook/:resultId Route (13.2)

### Audit Finding
- **Status:** ❌ Missing
- **Criterion:** /ap/teacher/gradebook/:resultId → APGradebook with side-panel open
- **Current State:** No route with resultId parameter

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/pages/APGradebook.jsx` (lines 121-122) - Has `selectedResultId` and `isPanelOpen` state
- **Current Implementation:**
  - Panel opens via button click, not direct URL
  - State managed internally, not from URL params

### Fix Plan

#### Step 1: Add route with resultId parameter
**File:** `src/apBoost/routes.jsx`
**Action:** Modify
**Details:**
```jsx
<Route
  path="/ap/teacher/gradebook/:resultId"
  element={
    <RoleProtectedRoute allowedRoles={['teacher', 'admin']}>
      <APGradebook />
    </RoleProtectedRoute>
  }
/>
```

#### Step 2: Modify APGradebook to read resultId from URL
**File:** `src/apBoost/pages/APGradebook.jsx`
**Action:** Modify
**Details:**
- Add: `const { resultId: urlResultId } = useParams()`
- Add useEffect to open panel when resultId is in URL:
```jsx
useEffect(() => {
  if (urlResultId) {
    setSelectedResultId(urlResultId)
    setIsPanelOpen(true)
  }
}, [urlResultId])
```

### Verification Steps
1. Navigate directly to `/ap/teacher/gradebook/abc123`
2. Verify panel opens automatically with that result
3. Verify closing panel updates URL

### Potential Risks
- Low risk: Additive change
- Consider updating URL when panel opens/closes

---

## Issue 10: Missing /ap/teacher/test/new Route (13.2)

### Audit Finding
- **Status:** ❌ Missing
- **Criterion:** /ap/teacher/test/new → APTestEditor (create)
- **Current State:** Route NOT defined but IS referenced in dashboard

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/pages/APTeacherDashboard.jsx` (line 217) - Links to `/ap/teacher/test/new`
  - `src/apBoost/routes.jsx` - Route missing
  - `src/apBoost/pages/APTestEditor.jsx` (line 207) - Checks `isNew = testId === 'new'`
- **Current Implementation:**
  - APTestEditor already handles `testId === 'new'` case
  - But no route to get there
- **Gap:** Critical - button in UI leads nowhere

### Fix Plan

#### Step 1: Add route for new test
**File:** `src/apBoost/routes.jsx`
**Action:** Modify
**Details:**
```jsx
<Route
  path="/ap/teacher/test/new"
  element={
    <RoleProtectedRoute allowedRoles={['teacher', 'admin']}>
      <APTestEditor />
    </RoleProtectedRoute>
  }
/>
```
- Place BEFORE the `/ap/teacher/test/:testId/edit` route (order matters for matching)

### Verification Steps
1. Click "Create New Test" button on teacher dashboard
2. Verify APTestEditor loads in create mode
3. Create and save a test
4. Verify redirect to edit mode works

### Potential Risks
- Low risk: Route already expected by component
- Ensure route is placed before parameterized route

---

## Issue 11: Test Editor Route Path Has /edit Suffix (13.2)

### Audit Finding
- **Status:** ⚠️ Partial (Different Path)
- **Criterion:** /ap/teacher/test/:testId → APTestEditor (edit)
- **Current State:** Route is `/ap/teacher/test/:testId/edit` (has /edit suffix)

### Code Analysis
- **Relevant Files:**
  - `src/apBoost/routes.jsx` (line 60) - Path includes `/edit`
  - `src/apBoost/pages/APTeacherDashboard.jsx` (line 59) - Links to `/ap/teacher/test/${test.id}/edit`
- **Current Implementation:** Works but path differs from criteria

### Fix Plan

#### Option A: Change path to match criteria
**File:** `src/apBoost/routes.jsx`
**Action:** Modify
**Details:**
- Change line 60: `path="/ap/teacher/test/:testId"`
- Update all links throughout the codebase

#### Option B: Keep current path (recommended)
**Rationale:** The `/edit` suffix provides clarity that this is edit mode vs. view mode. This is a common pattern.

### Recommended: Option B - No Change Needed
- The current pattern (`/edit` suffix) is clearer for UX
- Document this as intentional deviation from criteria

### Verification Steps
- Verify all edit links work correctly
- Consider if a view-only test page is needed

---

## Issue 12: Missing APStudentProfile Page (13.2)

### Audit Finding
- **Status:** ❌ Missing
- **Criterion:** /ap/teacher/student/:userId → APStudentProfile (stub)
- **Current State:** Page and route completely missing

### Code Analysis
- No existing file
- Noted as "stub" in criteria - minimal implementation acceptable

### Fix Plan

#### Step 1: Create APStudentProfile.jsx
**File:** `src/apBoost/pages/APStudentProfile.jsx`
**Action:** Create new page
**Details:**
```jsx
import { useState, useEffect } from 'react'
import { useParams, Link } from 'react-router-dom'
import APHeader from '../components/APHeader'
import { getStudentProfile, getStudentResults } from '../services/apTeacherService'
import { logError } from '../utils/logError'

export default function APStudentProfile() {
  const { userId } = useParams()
  const [student, setStudent] = useState(null)
  const [results, setResults] = useState([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)

  useEffect(() => {
    async function loadStudent() {
      try {
        setLoading(true)
        const [studentData, resultsData] = await Promise.all([
          getStudentProfile(userId),
          getStudentResults(userId),
        ])
        setStudent(studentData)
        setResults(resultsData)
      } catch (err) {
        logError('APStudentProfile.load', { userId }, err)
        setError(err.message)
      } finally {
        setLoading(false)
      }
    }
    loadStudent()
  }, [userId])

  // Render student info, test results list, etc.
  // ... stub implementation
}
```

#### Step 2: Add service functions
**File:** `src/apBoost/services/apTeacherService.js`
**Action:** Modify - Add functions
**Details:**
- Add `getStudentProfile(userId)` - Fetch user document
- Add `getStudentResults(userId)` - Fetch test results for student

#### Step 3: Add route
**File:** `src/apBoost/routes.jsx`
**Action:** Modify
**Details:**
```jsx
<Route
  path="/ap/teacher/student/:userId"
  element={
    <RoleProtectedRoute allowedRoles={['teacher', 'admin']}>
      <APStudentProfile />
    </RoleProtectedRoute>
  }
/>
```

### Verification Steps
1. Navigate to `/ap/teacher/student/:userId`
2. Verify student info loads
3. Verify test results list displays

### Potential Risks
- Medium complexity: Requires new service functions
- May need to link from gradebook/analytics

---

## Issue 13: Missing Class Management Route (13.2)

### Audit Finding
- **Status:** ❌ Missing
- **Criterion:** /ap/teacher/class/:classId → Class management
- **Current State:** Route and page completely missing

### Code Analysis
- Covered in Issue 3 (Create and Manage Classes Page)

### Fix Plan
See Issue 3 - Fix includes both `/ap/teacher/classes` and `/ap/teacher/class/:classId` routes

---

## Issue 14: No Role-Based Access Control (12.3)

### Audit Finding
- **Status:** ⚠️ Partial
- **Criterion:** Admins can access all teacher capabilities
- **Current State:** PrivateRoute only checks authentication, not roles

### Code Analysis
- Covered in Issue 5 (Admin Question Bank Access)

### Fix Plan
See Issue 5 - RoleProtectedRoute component handles all role-based access

---

## Implementation Order

Recommended order to implement fixes (considering dependencies):

1. **Issue 5: RoleProtectedRoute** - Foundational for role-based access control
2. **Issue 10: /ap/teacher/test/new Route** - Critical bug fix (button leads nowhere)
3. **Issue 1: Download Report PDF Button** - Quick win, utility already exists
4. **Issue 4: Export Questions PDF Button** - Quick win, utility already exists
5. **Issue 8: Gradebook Route Path** - Simple rename
6. **Issue 9: Gradebook with resultId** - Builds on issue 8
7. **Issue 6: isPublic Toggle** - Simple UI addition
8. **Issue 7: /ap/test/:testId/review Route** - Simple route addition
9. **Issue 3 & 13: Class Management Page** - New page and service (larger effort)
10. **Issue 12: APStudentProfile Page** - New page (stub acceptable)
11. **Issue 11: Test Editor Path** - No change recommended

## Cross-Cutting Concerns

### RoleProtectedRoute Component
- Create once, use for all teacher/admin routes
- Pattern: Check user.role against allowedRoles array
- Admin role has access to everything

### Service Layer Additions
- `apClassService.js` - New service for class CRUD
- `apTeacherService.js` additions for student profile

### UI Patterns to Follow
- Use existing button styles from APReportCard, APTestEditor
- Use dropdown pattern from APTestEditor for PDF export options
- Follow APHeader + main container layout pattern

## Notes for Implementer

1. **Test Role Data:** Ensure test users have appropriate roles in Firestore
2. **Backward Compatibility:** Keep `/ap/gradebook` as redirect to `/ap/teacher/gradebook`
3. **Error States:** All new pages should handle loading/error states like existing pages
4. **Design Tokens:** Use design tokens from `/src/index.css` per CLAUDE.md instructions
5. **Change Log:** Log all changes to `change_action_log_ap.md`

## Quality Verification
- [ ] Every ⚠️/❌/❓ issue from audit has fix plan
- [ ] Each fix plan includes specific file paths and line numbers
- [ ] Each fix plan references existing code patterns
- [ ] Dependencies between fixes identified
- [ ] Implementation order is logical
- [ ] Verification steps are actionable
- [ ] Potential risks documented

---

## Part 2: Codebase Facts

# CODEBASE_FACTS__UNK__12.1_to_13.2

**Inspector:** Claude Agent
**Date:** 2026-01-14
**Chunk ID:** UNK__12.1_to_13.2
**Source:** Fix Plan Sections 12.1 to 13.2

---

## 1) Canonical Data Schema / Source-of-Truth

**Found: Yes**

### Collection Names (from apTypes.js)
- `ap_tests` - Test definitions
- `ap_questions` - Question bank
- `ap_classes` - Class/roster data
- `ap_assignments` - Test assignments
- `ap_test_results` - Student test results
- `ap_session_state` - Active test sessions

**Evidence:**
- File: `src/apBoost/utils/apTypes.js` L90-98
```javascript
export const COLLECTIONS = {
  TESTS: 'ap_tests',
  QUESTIONS: 'ap_questions',
  STIMULI: 'ap_stimuli',
  SESSION_STATE: 'ap_session_state',
  TEST_RESULTS: 'ap_test_results',
  CLASSES: 'ap_classes',
  ASSIGNMENTS: 'ap_assignments',
}
```

### Test Schema (isPublic field)
- `isPublic` field EXISTS in data model and is queried
- Field is NOT exposed in APTestEditor UI
- Only set via seed data

**Evidence:**
- File: `src/apBoost/services/apTestService.js` L27
```javascript
where('isPublic', '==', true)
```
- File: `src/apBoost/utils/seedTestData.js` L26
```javascript
isPublic: true,
```
- File: `src/apBoost/pages/APTestEditor.jsx` - NO `isPublic` state or field (only `isPublished` at L215, L244)

### User Role Storage
- Role stored in Firestore `users` collection under `role` field
- Default role is `'student'` when not found or on error

**Evidence:**
- File: `src/contexts/AuthContext.jsx` L32-56
```javascript
const loadProfile = async () => {
  try {
    const userSnap = await getDoc(doc(db, 'users', firebaseUser.uid))
    const userData = userSnap.exists() ? userSnap.data() : {}
    if (isMounted) {
      setUser({
        ...firebaseUser,
        role: userData.role ?? 'student',
        profile: userData.profile ?? null,
        stats: userData.stats ?? null,
        settings: userData.settings ?? null,
      })
    }
  } catch {
    if (isMounted) {
      setUser({
        ...firebaseUser,
        role: 'student',
      })
    }
  }
}
```

### Class Schema Fields
- Collection: `ap_classes`
- Fields: `teacherId`, `name`, `period`, `studentIds[]`

**Evidence:**
- File: `src/apBoost/services/apTeacherService.js` L160-178
```javascript
export async function getTeacherClasses(teacherId) {
  try {
    const classesRef = collection(db, COLLECTIONS.CLASSES)
    const q = query(
      classesRef,
      where('teacherId', '==', teacherId),
      orderBy('name', 'asc')
    )
    const snapshot = await getDocs(q)
    return snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    }))
  }
}
```
- File: `src/apBoost/services/apTeacherService.js` L185-223 (getClassStudents references `studentIds`)

### Result Object for Report PDF
- Sources from `ap_test_results` collection via `getTestResult()`
- Fields used: `mcqResults`, `frqAnswers`, `frqGrades`, `apScore`, `score`, `maxScore`, `percentage`, `completedAt`, `gradingStatus`, `frqSubmissionType`, `frqUploadedFiles`, `annotatedPdfUrl`

**Evidence:**
- File: `src/apBoost/pages/APReportCard.jsx` L277-297, L339-355
```javascript
const resultData = await getTestResult(resultId)
// ...
const gradingStatus = result?.gradingStatus || GRADING_STATUS.NOT_NEEDED
const mcqResults = result?.mcqResults || []
const frqAnswers = result?.frqAnswers || {}
const frqGrades = result?.frqGrades || {}
const isHandwritten = result?.frqSubmissionType === FRQ_SUBMISSION_TYPE.HANDWRITTEN
const uploadedFiles = result?.frqUploadedFiles || []
const annotatedPdfUrl = result?.annotatedPdfUrl
```

---

## 2) Write Paths

**Found: Yes (Partial)**

### Report PDF Generation - Client-Side Only
- `downloadReportPdf` is purely client-side (generates PDF and triggers browser download)
- Does NOT write to Firestore or Storage
- Function exists but is NOT imported/used in APReportCard.jsx

**Evidence:**
- File: `src/apBoost/utils/generateReportPdf.js` L244-248
```javascript
export async function downloadReportPdf(result, test, student) {
  const doc = await generateReportPdf(result, test, student)
  const filename = `AP_Report_${student?.name?.replace(/\s+/g, '_') || 'Student'}_${new Date().toISOString().split('T')[0]}.pdf`
  doc.save(filename)
}
```
- File: `src/apBoost/pages/APReportCard.jsx` - NO import of `downloadReportPdf`

### Questions PDF Export - Utility Exists, NOT Wired
- `downloadQuestionsPdf` utility exists
- NOT imported or used anywhere in APTestEditor or other pages

**Evidence:**
- File: `src/apBoost/utils/generateQuestionsPdf.js` L271-275
```javascript
export async function downloadQuestionsPdf(test, questions, options = {}) {
  const doc = await generateQuestionsPdf(test, questions, options)
  const filename = `${test?.title?.replace(/\s+/g, '_') || 'Questions'}_${options.includeAnswers ? 'Teacher' : 'Student'}.pdf`
  doc.save(filename)
}
```
- Grep result: `downloadQuestionsPdf` only appears in utility file and audit markdown files - NOT in any page/component

### Class CRUD Services
- **getTeacherClasses** - EXISTS (L160-178)
- **getClassStudents** - EXISTS (L185-223)
- **createClass** - NOT FOUND
- **updateClass** - NOT FOUND
- **deleteClass** - NOT FOUND
- **addStudentsToClass** - NOT FOUND
- **removeStudentFromClass** - NOT FOUND

**Evidence:**
- File: `src/apBoost/services/apTeacherService.js` - Full file read, only contains:
  - `getTeacherTests`, `createTest`, `updateTest`, `deleteTest`, `getTestById`
  - `getTeacherClasses`, `getClassStudents`
  - `createAssignment`, `getTestAssignments`
  - `getPendingGradingCount`, `getPendingGradingList`
  - `publishTest`, `unpublishTest`

### isPublic Field Persistence
- NOT included in APTestEditor save payload
- Field only appears in seed data

**Evidence:**
- File: `src/apBoost/pages/APTestEditor.jsx` L358-365 (handleSave testData)
```javascript
const testData = {
  title: title.trim(),
  subject,
  testType,
  sections,
  scoreRanges,
  createdBy: user?.uid,
}
```
Note: NO `isPublic` field in this object

### Role-Based Gating
- NO RoleProtectedRoute component exists
- PrivateRoute only checks authentication, NOT role

**Evidence:**
- File: `src/components/PrivateRoute.jsx` L4-20 (complete file)
```javascript
const PrivateRoute = ({ children }) => {
  const { user, initializing } = useAuth()

  if (initializing) {
    return (/* loading UI */)
  }

  if (!user) {
    return <Navigate to="/login" replace />
  }

  return children
}
```
- Glob search for `RoleProtectedRoute*` returned: No files found

---

## 3) Offline/Resilience Mechanics

**Found: No**

Not applicable to the features in scope (PDF generation, routing, role checks). The test session has resilience (connection status, duplicate tab handling) but that's unrelated to these features.

---

## 4) UI/Flow Entry Points

**Found: Yes**

### Route Definitions (from routes.jsx)

| Route | Component | Exists |
|-------|-----------|--------|
| `/ap/results/:resultId` | APReportCard | ✅ Yes (L41-48) |
| `/ap/gradebook` | APGradebook | ✅ Yes (L91-98) |
| `/ap/teacher/gradebook` | N/A | ❌ NOT FOUND |
| `/ap/teacher/test/:testId/edit` | APTestEditor | ✅ Yes (L59-66) |
| `/ap/teacher/test/new` | N/A | ❌ NOT FOUND |
| `/ap/test/:testId/review` | N/A | ❌ NOT FOUND (internal state only) |
| `/ap/teacher/classes` | N/A | ❌ NOT FOUND |
| `/ap/teacher/class/:classId` | N/A | ❌ NOT FOUND |
| `/ap/teacher/student/:userId` | N/A | ❌ NOT FOUND |

**Evidence:**
- File: `src/apBoost/routes.jsx` L14-108 (complete file)
```javascript
export const apBoostRoutes = (
  <>
    {/* Student Routes */}
    <Route path="/ap" element={<PrivateRoute><APDashboard /></PrivateRoute>} />
    <Route path="/ap/test/:testId" element={<PrivateRoute><APTestSession /></PrivateRoute>} />
    <Route path="/ap/test/:testId/assignment/:assignmentId" element={<PrivateRoute><APTestSession /></PrivateRoute>} />
    <Route path="/ap/results/:resultId" element={<PrivateRoute><APReportCard /></PrivateRoute>} />

    {/* Teacher Routes */}
    <Route path="/ap/teacher" element={<PrivateRoute><APTeacherDashboard /></PrivateRoute>} />
    <Route path="/ap/teacher/test/:testId/edit" element={<PrivateRoute><APTestEditor /></PrivateRoute>} />
    <Route path="/ap/teacher/test/:testId/assign" element={<PrivateRoute><APAssignTest /></PrivateRoute>} />
    <Route path="/ap/teacher/questions" element={<PrivateRoute><APQuestionBank /></PrivateRoute>} />
    <Route path="/ap/teacher/question/:questionId/edit" element={<PrivateRoute><APQuestionEditor /></PrivateRoute>} />
    <Route path="/ap/gradebook" element={<PrivateRoute><APGradebook /></PrivateRoute>} />
    <Route path="/ap/teacher/analytics/:testId" element={<PrivateRoute><APExamAnalytics /></PrivateRoute>} />
  </>
)
```

### UI Links to Missing Routes

**"Create New Test" button links to missing route:**
- File: `src/apBoost/pages/APTeacherDashboard.jsx` L216-221
```javascript
<QuickActionButton
  to="/ap/teacher/test/new"
  icon="+"
  label="Create New Test"
  primary
/>
```

**Student profile link to missing route:**
- File: `src/apBoost/pages/APExamAnalytics.jsx` L194-197
```javascript
const handleStudentClick = (userId) => {
  navigate(`/ap/teacher/student/${userId}`)
}
```

**QuestionBank also references /ap/teacher/test/new:**
- File: `src/apBoost/pages/APQuestionBank.jsx` L316, L355
```javascript
const backUrl = testId ? `/ap/teacher/test/${testId}/edit` : '/ap/teacher/test/new'
```

### APReportCard Actions Section
- Currently only has "Back to Dashboard" link
- NO PDF download button

**Evidence:**
- File: `src/apBoost/pages/APReportCard.jsx` L497-505
```javascript
{/* Actions */}
<div className="flex justify-center gap-4">
  <Link
    to="/ap"
    className="bg-surface text-text-primary px-6 py-2 rounded-[--radius-button] border border-border-default hover:bg-hover transition-colors"
  >
    Back to Dashboard
  </Link>
</div>
```

### Review Flow (Internal State, Not Route)
- Review is a view state inside APTestSession, NOT a separate route
- State: `'instruction' | 'testing' | 'review' | 'frqChoice' | 'frqHandwritten'`

**Evidence:**
- File: `src/apBoost/pages/APTestSession.jsx` L44-45
```javascript
// View state: 'instruction' | 'testing' | 'review' | 'frqChoice' | 'frqHandwritten'
const [view, setView] = useState('instruction')
```
- File: `src/apBoost/pages/APTestSession.jsx` L351-384 (review screen rendering)
```javascript
if (view === 'review') {
  return (
    <div className="min-h-screen bg-base">
      <APHeader />
      <ReviewScreen ... />
    </div>
  )
}
```

### Gradebook Panel State
- Panel opened via click handler, NOT URL params
- No `useParams` for deep linking

**Evidence:**
- File: `src/apBoost/pages/APGradebook.jsx` L121-122
```javascript
const [selectedResultId, setSelectedResultId] = useState(null)
const [isPanelOpen, setIsPanelOpen] = useState(false)
```
- File: `src/apBoost/pages/APGradebook.jsx` L182-191
```javascript
const handleGrade = (resultId) => {
  setSelectedResultId(resultId)
  setIsPanelOpen(true)
}

const handleView = (resultId) => {
  setSelectedResultId(resultId)
  setIsPanelOpen(true)
}
```

---

## 5) Must-Answer Questions (Checklist)

### 1. Does `src/apBoost/utils/generateReportPdf.js` exist, and does it export `downloadReportPdf`? How is jsPDF imported/used?

**Answer:** Yes, file exists and exports `downloadReportPdf`. jsPDF is imported at line 5 and instantiated at line 15.

**Evidence:**
- File: `src/apBoost/utils/generateReportPdf.js` L5
```javascript
import jsPDF from 'jspdf'
```
- File: `src/apBoost/utils/generateReportPdf.js` L14-15
```javascript
export async function generateReportPdf(result, test, student) {
  const doc = new jsPDF()
```
- File: `src/apBoost/utils/generateReportPdf.js` L244-248
```javascript
export async function downloadReportPdf(result, test, student) {
  const doc = await generateReportPdf(result, test, student)
  const filename = `AP_Report_${student?.name?.replace(/\s+/g, '_') || 'Student'}_${new Date().toISOString().split('T')[0]}.pdf`
  doc.save(filename)
}
```

### 2. In `APReportCard.jsx`, is `downloadReportPdf` imported anywhere today? Is there any button or handler that triggers a PDF download?

**Answer:** NO. `downloadReportPdf` is NOT imported. No PDF download button exists in the Actions section.

**Evidence:**
- File: `src/apBoost/pages/APReportCard.jsx` L1-8 (imports)
```javascript
import { useState, useEffect } from 'react'
import { useParams, useNavigate, Link } from 'react-router-dom'
import { useAuth } from '../../contexts/AuthContext'
import APHeader from '../components/APHeader'
import { getTestResult } from '../services/apScoringService'
import { getTestMeta } from '../services/apTestService'
import { getSubjectConfig } from '../utils/apTestConfig'
import { GRADING_STATUS, FRQ_SUBMISSION_TYPE } from '../utils/apTypes'
```
No `generateReportPdf` or `downloadReportPdf` import present.

- File: `src/apBoost/pages/APReportCard.jsx` L497-505 (Actions section - only has Back to Dashboard)
```javascript
{/* Actions */}
<div className="flex justify-center gap-4">
  <Link to="/ap" className="...">Back to Dashboard</Link>
</div>
```

### 3. What is the exact route path that renders APReportCard (results page), and what params does it use?

**Answer:** `/ap/results/:resultId` renders APReportCard. Uses `resultId` param.

**Evidence:**
- File: `src/apBoost/routes.jsx` L41-48
```javascript
<Route
  path="/ap/results/:resultId"
  element={
    <PrivateRoute>
      <APReportCard />
    </PrivateRoute>
  }
/>
```
- File: `src/apBoost/pages/APReportCard.jsx` L262
```javascript
const { resultId } = useParams()
```

### 4. Does `ScoreRangesEditor` exist in `APTestEditor.jsx`, and is it actually rendered? Where is its state stored and saved?

**Answer:** YES. ScoreRangesEditor exists (L156-197), is rendered (L497-500). State stored in `scoreRanges` (L214), included in save payload (L363).

**Evidence:**
- File: `src/apBoost/pages/APTestEditor.jsx` L156-197 (ScoreRangesEditor component definition)
```javascript
function ScoreRangesEditor({ scoreRanges, onChange }) {
  const handleChange = (score, field, value) => {
    const newRanges = { ...scoreRanges }
    newRanges[score] = { ...newRanges[score], [field]: parseInt(value) || 0 }
    onChange(newRanges)
  }
  // ... rendering logic
}
```
- File: `src/apBoost/pages/APTestEditor.jsx` L214
```javascript
const [scoreRanges, setScoreRanges] = useState(DEFAULT_SCORE_RANGES)
```
- File: `src/apBoost/pages/APTestEditor.jsx` L496-500 (rendering)
```javascript
<div className="mb-6">
  <ScoreRangesEditor
    scoreRanges={scoreRanges}
    onChange={setScoreRanges}
  />
</div>
```
- File: `src/apBoost/pages/APTestEditor.jsx` L358-365 (save payload includes scoreRanges)
```javascript
const testData = {
  title: title.trim(),
  subject,
  testType,
  sections,
  scoreRanges,  // <-- included
  createdBy: user?.uid,
}
```

### 5. Is there already any questions PDF export UI wired to `downloadQuestionsPdf`? If not, confirm the utility exists and where it is referenced.

**Answer:** NO UI is wired to `downloadQuestionsPdf`. Utility exists at `src/apBoost/utils/generateQuestionsPdf.js` L271-275. Only referenced in audit markdown files, NOT in any page/component.

**Evidence:**
- File: `src/apBoost/utils/generateQuestionsPdf.js` L271-275
```javascript
export async function downloadQuestionsPdf(test, questions, options = {}) {
  const doc = await generateQuestionsPdf(test, questions, options)
  const filename = `${test?.title?.replace(/\s+/g, '_') || 'Questions'}_${options.includeAnswers ? 'Teacher' : 'Student'}.pdf`
  doc.save(filename)
}
```
- Grep results for `downloadQuestionsPdf` show only:
  - `src/apBoost/utils/generateQuestionsPdf.js` (definition)
  - Various `criteria_audit/*.md` files (documentation only)

### 6. What is the current route for gradebook (exact path), and do any teacher-prefixed routes exist? Are there links pointing to the old path?

**Answer:** Current route is `/ap/gradebook` (NOT teacher-prefixed). No `/ap/teacher/gradebook` route exists. Links in APTeacherDashboard correctly point to `/ap/gradebook`.

**Evidence:**
- File: `src/apBoost/routes.jsx` L91-98
```javascript
<Route
  path="/ap/gradebook"
  element={
    <PrivateRoute>
      <APGradebook />
    </PrivateRoute>
  }
/>
```
- File: `src/apBoost/pages/APTeacherDashboard.jsx` L227-231
```javascript
<QuickActionButton
  to="/ap/gradebook"
  icon="G"
  label="Gradebook"
/>
```
- File: `src/apBoost/pages/APTeacherDashboard.jsx` L286-291
```javascript
<Link
  to="/ap/gradebook"
  className="text-brand-primary text-sm hover:underline"
>
  Go to Gradebook
</Link>
```

### 7. Does `APGradebook.jsx` support opening a side panel based on URL params today? If not, what state drives the panel?

**Answer:** NO URL param support. Panel driven entirely by component state: `selectedResultId` and `isPanelOpen`. No `useParams` usage.

**Evidence:**
- File: `src/apBoost/pages/APGradebook.jsx` L1-7 (imports - no useParams)
```javascript
import { useState, useEffect } from 'react'
import { useAuth } from '../../contexts/AuthContext'
import APHeader from '../components/APHeader'
import GradingPanel from '../components/grading/GradingPanel'
import { getPendingGrades, getTestsForGrading, getTeacherClasses } from '../services/apGradingService'
import { GRADING_STATUS } from '../utils/apTypes'
import { logError } from '../utils/logError'
```
- File: `src/apBoost/pages/APGradebook.jsx` L121-122
```javascript
const [selectedResultId, setSelectedResultId] = useState(null)
const [isPanelOpen, setIsPanelOpen] = useState(false)
```

### 8. Does `/ap/teacher/test/new` exist in routes today? If missing, confirm where the dashboard links to it and how APTestEditor detects "new" mode.

**Answer:** Route does NOT exist. Dashboard links to it at L217. APTestEditor detects new mode via `testId === 'new'` at L207.

**Evidence:**
- File: `src/apBoost/routes.jsx` - NO route for `/ap/teacher/test/new` (full file reviewed)
- File: `src/apBoost/pages/APTeacherDashboard.jsx` L216-221
```javascript
<QuickActionButton
  to="/ap/teacher/test/new"
  icon="+"
  label="Create New Test"
  primary
/>
```
- File: `src/apBoost/pages/APTestEditor.jsx` L203, L207
```javascript
const { testId } = useParams()
// ...
const isNew = testId === 'new'
```

### 9. Is there any RoleProtectedRoute (or equivalent) already? If not, what does PrivateRoute currently check?

**Answer:** NO RoleProtectedRoute exists. PrivateRoute only checks `user` existence (authentication), NOT role.

**Evidence:**
- Glob search `**/RoleProtectedRoute*` returned: No files found
- File: `src/components/PrivateRoute.jsx` L4-20 (complete component)
```javascript
const PrivateRoute = ({ children }) => {
  const { user, initializing } = useAuth()

  if (initializing) {
    return (
      <main className="flex min-h-screen items-center justify-center bg-slate-50">
        <p className="text-sm font-medium text-slate-600">Loading your workspace...</p>
      </main>
    )
  }

  if (!user) {
    return <Navigate to="/login" replace />
  }

  return children
}
```

### 10. Where is `user.role` sourced (AuthContext)? What is the default role if missing?

**Answer:** Sourced from Firestore `users` collection. Default is `'student'` (both when userData.role is undefined and on fetch error).

**Evidence:**
- File: `src/contexts/AuthContext.jsx` L32-56
```javascript
const loadProfile = async () => {
  try {
    const userSnap = await getDoc(doc(db, 'users', firebaseUser.uid))
    const userData = userSnap.exists() ? userSnap.data() : {}
    if (isMounted) {
      setUser({
        ...firebaseUser,
        role: userData.role ?? 'student',  // <-- default 'student'
        // ...
      })
    }
  } catch {
    if (isMounted) {
      setUser({
        ...firebaseUser,
        role: 'student',  // <-- default 'student' on error
      })
    }
  }
}
```

### 11. Does APQuestionBank have any role gating (route-level or component-level)? If yes, what roles are allowed?

**Answer:** NO role gating. Route uses generic PrivateRoute (auth only). Component has no role checks.

**Evidence:**
- File: `src/apBoost/routes.jsx` L75-82
```javascript
<Route
  path="/ap/teacher/questions"
  element={
    <PrivateRoute>
      <APQuestionBank />
    </PrivateRoute>
  }
/>
```
- File: `src/apBoost/pages/APQuestionBank.jsx` - Full file reviewed, no `user.role` checks

### 12. Do class CRUD services/pages already exist anywhere? If partially present, list what exists and what is NOT FOUND.

**Answer:** PARTIAL. Read functions exist; Create/Update/Delete do NOT exist. No class management pages exist.

**EXISTS:**
- `getTeacherClasses(teacherId)` - `src/apBoost/services/apTeacherService.js` L160-178
- `getClassStudents(classId)` - `src/apBoost/services/apTeacherService.js` L185-223

**NOT FOUND:**
- `createClass` function
- `updateClass` function
- `deleteClass` function
- `addStudentsToClass` function
- `removeStudentFromClass` function
- `/ap/teacher/classes` route
- `/ap/teacher/class/:classId` route
- `APClassManager` page component

**Evidence:**
- File: `src/apBoost/services/apTeacherService.js` - Complete file reviewed (381 lines), only exports listed functions
- Grep `createClass|deleteClass|updateClass` in `src/apBoost` - Only found in audit markdown files
- Grep `/ap/teacher/class` in `src/apBoost` - Only found in audit markdown files

---

## Summary of Key Findings

| Feature | Status | Notes |
|---------|--------|-------|
| Report PDF download button | ❌ NOT WIRED | Utility exists, not imported in APReportCard |
| Questions PDF export UI | ❌ NOT WIRED | Utility exists, not used anywhere |
| ScoreRangesEditor | ✅ WORKING | Rendered and saved correctly |
| isPublic toggle | ❌ MISSING | Field exists in DB, no UI to set it |
| RoleProtectedRoute | ❌ NOT FOUND | Only auth check, no role check |
| /ap/teacher/test/new route | ❌ MISSING | Links exist but route undefined |
| /ap/test/:testId/review route | ❌ N/A | Review is internal state, not route |
| Gradebook deep linking | ❌ NOT IMPLEMENTED | Panel state-driven only |
| Class CRUD services | ⚠️ PARTIAL | Read exists; CUD missing |
| Class management pages | ❌ NOT FOUND | No routes or pages |
| Student profile page | ❌ NOT FOUND | Link exists in Analytics, route missing |
